<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>Sparse regression with paired covariates</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Sparse regression with paired covariates</h1>



<p>Code for reproducing the results shown in the manuscript.</p>
<div id="initialisation" class="section level1">
<h1>Initialisation</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co">### Loading functions. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">inst &lt;-<span class="st"> </span><span class="kw">rownames</span>(utils<span class="op">::</span><span class="kw">installed.packages</span>())</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">cran &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;devtools&quot;</span>,<span class="st">&quot;R.utils&quot;</span>,<span class="st">&quot;Matrix&quot;</span>,<span class="st">&quot;glmnet&quot;</span>,<span class="st">&quot;pROC&quot;</span>,<span class="st">&quot;BiocManager&quot;</span>,<span class="st">&quot;ashr&quot;</span>)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># &quot;googledrive&quot;, &quot;httpuv&quot;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(cran <span class="op">%in%</span><span class="st"> </span>inst)){</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(cran)){</a>
<a class="sourceLine" id="cb1-9" title="9">        <span class="cf">if</span>(<span class="op">!</span>cran[i] <span class="op">%in%</span><span class="st"> </span>inst){</a>
<a class="sourceLine" id="cb1-10" title="10">            <span class="kw">install.packages</span>(cran[i])</a>
<a class="sourceLine" id="cb1-11" title="11">        }</a>
<a class="sourceLine" id="cb1-12" title="12">    }</a>
<a class="sourceLine" id="cb1-13" title="13">}</a>
<a class="sourceLine" id="cb1-14" title="14"></a>
<a class="sourceLine" id="cb1-15" title="15">bioc &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;edgeR&quot;</span>,<span class="st">&quot;TCGAbiolinks&quot;</span>)</a>
<a class="sourceLine" id="cb1-16" title="16"><span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(bioc <span class="op">%in%</span><span class="st"> </span>inst)){</a>
<a class="sourceLine" id="cb1-17" title="17">    <span class="co">#source(&quot;http://bioconductor.org/biocLite.R&quot;)</span></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(bioc)){</a>
<a class="sourceLine" id="cb1-19" title="19">        <span class="cf">if</span>(<span class="op">!</span>bioc[i] <span class="op">%in%</span><span class="st"> </span>inst){</a>
<a class="sourceLine" id="cb1-20" title="20">            <span class="co">#biocLite(bioc[i])</span></a>
<a class="sourceLine" id="cb1-21" title="21">            BiocManager<span class="op">::</span><span class="kw">install</span>(bioc[i])</a>
<a class="sourceLine" id="cb1-22" title="22">        }</a>
<a class="sourceLine" id="cb1-23" title="23">    }</a>
<a class="sourceLine" id="cb1-24" title="24">}</a>
<a class="sourceLine" id="cb1-25" title="25"></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co">#if(!&quot;ashr&quot; %in% inst){</span></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="co">#  devtools::install_github(&quot;stephens999/ashr&quot;)</span></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co">#}</span></a>
<a class="sourceLine" id="cb1-29" title="29"></a>
<a class="sourceLine" id="cb1-30" title="30">user &lt;-<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&quot;USERNAME&quot;</span>)</a>
<a class="sourceLine" id="cb1-31" title="31">path &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;C:&quot;</span>,<span class="st">&quot;Users&quot;</span>,user,<span class="st">&quot;Desktop&quot;</span>,<span class="st">&quot;palasso&quot;</span>)</a>
<a class="sourceLine" id="cb1-32" title="32"><span class="cf">if</span>(user<span class="op">==</span><span class="st">&quot;arra&quot;</span>){path &lt;-<span class="st"> &quot;C:/Users/arra/Desktop/MATHS/palasso_desktop&quot;</span>}</a>
<a class="sourceLine" id="cb1-33" title="33"><span class="cf">if</span>(user<span class="op">==</span><span class="st">&quot;&quot;</span>){path &lt;-<span class="st"> &quot;/virdir/Scratch/arauschenberger/palasso&quot;</span>}</a>
<a class="sourceLine" id="cb1-34" title="34"><span class="kw">setwd</span>(path)</a>
<a class="sourceLine" id="cb1-35" title="35">folders &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;results&quot;</span>)</a>
<a class="sourceLine" id="cb1-36" title="36"><span class="kw">invisible</span>(<span class="kw">sapply</span>(folders,<span class="cf">function</span>(x) <span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(x)){<span class="kw">dir.create</span>(x)}))</a>
<a class="sourceLine" id="cb1-37" title="37"></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="cf">if</span>(user<span class="op">!=</span><span class="st">&quot;arra&quot;</span>){</a>
<a class="sourceLine" id="cb1-39" title="39">    devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;kkdey/CorShrink&quot;</span>) <span class="co"># ref=&quot;a9f6ba0&quot;</span></a>
<a class="sourceLine" id="cb1-40" title="40">    devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;rauschenberger/palasso&quot;</span>) <span class="co"># ref=&quot;4a995a2&quot;</span></a>
<a class="sourceLine" id="cb1-41" title="41">}</a>
<a class="sourceLine" id="cb1-42" title="42"></a>
<a class="sourceLine" id="cb1-43" title="43"><span class="cf">if</span>(<span class="ot">FALSE</span>){</a>
<a class="sourceLine" id="cb1-44" title="44">    </a>
<a class="sourceLine" id="cb1-45" title="45">    <span class="co"># The functions &lt;&lt;save&gt;&gt;, &lt;&lt;file.exists&gt;&gt; and &lt;&lt;file.remove&gt;&gt; access the hard disk, but also try to access googledrive.</span></a>
<a class="sourceLine" id="cb1-46" title="46">    </a>
<a class="sourceLine" id="cb1-47" title="47">    save &lt;-<span class="st"> </span><span class="cf">function</span>(object,file){</a>
<a class="sourceLine" id="cb1-48" title="48">        base<span class="op">::</span><span class="kw">save</span>(object,<span class="dt">file=</span>file)</a>
<a class="sourceLine" id="cb1-49" title="49">        <span class="kw">tryCatch</span>(<span class="dt">expr=</span>googledrive<span class="op">::</span><span class="kw">drive_upload</span>(<span class="dt">media=</span>file,<span class="dt">path=</span>file),</a>
<a class="sourceLine" id="cb1-50" title="50">                 <span class="dt">error=</span><span class="cf">function</span>(x) <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1-51" title="51">        <span class="co">#Sys.sleep(0.5)</span></a>
<a class="sourceLine" id="cb1-52" title="52">    }</a>
<a class="sourceLine" id="cb1-53" title="53"></a>
<a class="sourceLine" id="cb1-54" title="54">    file.exists &lt;-<span class="st"> </span><span class="cf">function</span>(file){</a>
<a class="sourceLine" id="cb1-55" title="55">        offline &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">file.exists</span>(file)</a>
<a class="sourceLine" id="cb1-56" title="56">        online &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1-57" title="57">        <span class="cf">if</span>(<span class="op">!</span>offline){</a>
<a class="sourceLine" id="cb1-58" title="58">            d &lt;-<span class="st"> </span>googledrive<span class="op">::</span><span class="kw">as_dribble</span>(<span class="dt">x=</span>file)</a>
<a class="sourceLine" id="cb1-59" title="59">            online &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(<span class="dt">expr=</span>googledrive<span class="op">::</span><span class="kw">some_files</span>(d),</a>
<a class="sourceLine" id="cb1-60" title="60">                               <span class="dt">error=</span><span class="cf">function</span>(x) <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-61" title="61">            <span class="co">#Sys.sleep(0.5)</span></a>
<a class="sourceLine" id="cb1-62" title="62">        }</a>
<a class="sourceLine" id="cb1-63" title="63">        <span class="kw">return</span>(offline<span class="op">|</span>online)</a>
<a class="sourceLine" id="cb1-64" title="64">    }</a>
<a class="sourceLine" id="cb1-65" title="65"></a>
<a class="sourceLine" id="cb1-66" title="66">    file.remove &lt;-<span class="st"> </span><span class="cf">function</span>(file){</a>
<a class="sourceLine" id="cb1-67" title="67">        base<span class="op">::</span><span class="kw">file.remove</span>(file)</a>
<a class="sourceLine" id="cb1-68" title="68">        <span class="kw">tryCatch</span>(<span class="dt">expr=</span>googledrive<span class="op">::</span><span class="kw">drive_trash</span>(<span class="dt">file=</span>file),</a>
<a class="sourceLine" id="cb1-69" title="69">             <span class="dt">error=</span><span class="cf">function</span>(x) <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1-70" title="70">        <span class="co">#Sys.sleep(0.5)</span></a>
<a class="sourceLine" id="cb1-71" title="71">    }</a>
<a class="sourceLine" id="cb1-72" title="72">    </a>
<a class="sourceLine" id="cb1-73" title="73">    </a>
<a class="sourceLine" id="cb1-74" title="74"><span class="co"># The function &lt;&lt;update&gt;&gt; moves files from the research cloud to the remote drive. Given both paths, it first verifies whether the folders SIM, GDC and CCA are available, and then copies all missing files from the research cloud to the remote drive.</span></a>
<a class="sourceLine" id="cb1-75" title="75"></a>
<a class="sourceLine" id="cb1-76" title="76"><span class="co"># from: path to the origin</span></a>
<a class="sourceLine" id="cb1-77" title="77"><span class="co"># to: path to the destination</span></a>
<a class="sourceLine" id="cb1-78" title="78"></a>
<a class="sourceLine" id="cb1-79" title="79">update &lt;-<span class="st"> </span><span class="cf">function</span>(from,to){</a>
<a class="sourceLine" id="cb1-80" title="80">    dir &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SIM&quot;</span>,<span class="st">&quot;GDC&quot;</span>,<span class="st">&quot;CCA&quot;</span>)</a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="cf">if</span>(<span class="kw">any</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="kw">file.path</span>(from,dir)))){<span class="kw">stop</span>(<span class="st">&quot;Invalid.&quot;</span>)}</a>
<a class="sourceLine" id="cb1-82" title="82">    <span class="cf">if</span>(<span class="kw">any</span>(<span class="op">!</span><span class="kw">dir.exists</span>(<span class="kw">file.path</span>(to,dir)))){<span class="kw">stop</span>(<span class="st">&quot;Invalid.&quot;</span>)}</a>
<a class="sourceLine" id="cb1-83" title="83">    pb &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">txtProgressBar</span>(<span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span><span class="dv">1</span>,<span class="dt">style=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1-84" title="84">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(dir)){</a>
<a class="sourceLine" id="cb1-85" title="85">        files0 &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="kw">file.path</span>(from,dir[i]))</a>
<a class="sourceLine" id="cb1-86" title="86">        files1 &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="kw">file.path</span>(to,dir[i]))</a>
<a class="sourceLine" id="cb1-87" title="87">        names &lt;-<span class="st"> </span>files0[<span class="op">!</span>files0 <span class="op">%in%</span><span class="st"> </span>files1]</a>
<a class="sourceLine" id="cb1-88" title="88">        <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(names)){</a>
<a class="sourceLine" id="cb1-89" title="89">            utils<span class="op">::</span><span class="kw">setTxtProgressBar</span>(<span class="dt">pb=</span>pb,<span class="dt">value=</span>(i<span class="dv">-1</span>)<span class="op">/</span><span class="dv">3</span><span class="op">+</span>(j<span class="op">*</span>i)<span class="op">/</span>(<span class="dv">3</span><span class="op">*</span><span class="kw">length</span>(names)))</a>
<a class="sourceLine" id="cb1-90" title="90">            <span class="kw">file.copy</span>(<span class="dt">from=</span><span class="kw">file.path</span>(from,dir[i],names[j]),</a>
<a class="sourceLine" id="cb1-91" title="91">                      <span class="dt">to=</span><span class="kw">file.path</span>(to,dir[i],names[j]),</a>
<a class="sourceLine" id="cb1-92" title="92">                      <span class="dt">copy.date=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-93" title="93">        }</a>
<a class="sourceLine" id="cb1-94" title="94">        utils<span class="op">::</span><span class="kw">setTxtProgressBar</span>(<span class="dt">pb=</span>pb,<span class="dt">value=</span>i<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1-95" title="95">    }</a>
<a class="sourceLine" id="cb1-96" title="96">}</a>
<a class="sourceLine" id="cb1-97" title="97"></a>
<a class="sourceLine" id="cb1-98" title="98"><span class="co"># update(from=&quot;results&quot;,to=&quot;//tsclient/N/palasso/results&quot;)</span></a>
<a class="sourceLine" id="cb1-99" title="99">    </a>
<a class="sourceLine" id="cb1-100" title="100">}</a></code></pre></div>
</div>
<div id="preparation" class="section level1">
<h1>Preparation</h1>
<p>Last data download started on 2019-03-26 (R version 3.5.3).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">### Downloading &quot;Isoform Expression Quantification&quot;. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6">directory &lt;-<span class="st"> </span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">setwd</span>(directory)</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># Retrieving cancer types:</span></a>
<a class="sourceLine" id="cb2-10" title="10">project &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">getGDCprojects</span>()<span class="op">$</span>id</a>
<a class="sourceLine" id="cb2-11" title="11">project &lt;-<span class="st"> </span>project[<span class="kw">grepl</span>(<span class="dt">x=</span>project,<span class="dt">pattern=</span><span class="st">&quot;TCGA&quot;</span>)]</a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co"># Downloading isoform expression data:</span></a>
<a class="sourceLine" id="cb2-14" title="14">y &lt;-<span class="st"> </span>X &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb2-15" title="15"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(project)){</a>
<a class="sourceLine" id="cb2-16" title="16">    query &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCquery</span>(<span class="dt">project=</span>project[i],</a>
<a class="sourceLine" id="cb2-17" title="17">                <span class="dt">data.category=</span><span class="st">&quot;Transcriptome Profiling&quot;</span>,</a>
<a class="sourceLine" id="cb2-18" title="18">                <span class="dt">data.type=</span><span class="st">&quot;Isoform Expression Quantification&quot;</span>)</a>
<a class="sourceLine" id="cb2-19" title="19">    TCGAbiolinks<span class="op">::</span><span class="kw">GDCdownload</span>(query,<span class="dt">method=</span><span class="st">&quot;api&quot;</span>,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="kw">trace</span>(TCGAbiolinks<span class="op">:::</span>readTranscriptomeProfiling,<span class="dt">tracer=</span><span class="kw">quote</span>(ignore.case&lt;-<span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb2-21" title="21">    X[[i]] &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCprepare</span>(query,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb2-22" title="22">    X[[i]][,<span class="kw">c</span>(<span class="st">&quot;miRNA_ID&quot;</span>,<span class="st">&quot;reads_per_million_miRNA_mapped&quot;</span>,</a>
<a class="sourceLine" id="cb2-23" title="23">              <span class="st">&quot;cross-mapped&quot;</span>,<span class="st">&quot;miRNA_region&quot;</span>)] &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb2-24" title="24">    y[[i]] &lt;-<span class="st"> </span><span class="kw">rep</span>(project[i],<span class="dt">times=</span><span class="kw">length</span>(<span class="kw">unique</span>(X[[i]]<span class="op">$</span>barcode)))</a>
<a class="sourceLine" id="cb2-25" title="25">}</a>
<a class="sourceLine" id="cb2-26" title="26"></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;isoform_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb2-28" title="28"><span class="kw">load</span>(<span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;isoform_raw.RData&quot;</span>),<span class="dt">verbose=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-29" title="29"></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co"># Merging isoform expression data:</span></a>
<a class="sourceLine" id="cb2-31" title="31">Xs &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span>rbind,<span class="dt">args=</span>X) <span class="co"># sparse matrix</span></a>
<a class="sourceLine" id="cb2-32" title="32">y &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span><span class="st">&quot;c&quot;</span>,<span class="dt">args=</span>y)</a>
<a class="sourceLine" id="cb2-33" title="33"></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co"># Transform to matrix</span></a>
<a class="sourceLine" id="cb2-35" title="35">Xs<span class="op">$</span>isoform_coords &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;hg38:chr&quot;</span>,<span class="dt">replacement=</span><span class="st">&quot;&quot;</span>,<span class="dt">x=</span>Xs<span class="op">$</span>isoform_coords)</a>
<a class="sourceLine" id="cb2-36" title="36">samples &lt;-<span class="st"> </span><span class="kw">unique</span>(Xs<span class="op">$</span>barcode)</a>
<a class="sourceLine" id="cb2-37" title="37">covariates &lt;-<span class="st"> </span><span class="kw">unique</span>(Xs<span class="op">$</span>isoform_coords)</a>
<a class="sourceLine" id="cb2-38" title="38">row &lt;-<span class="st"> </span><span class="kw">match</span>(Xs<span class="op">$</span>barcode,samples)</a>
<a class="sourceLine" id="cb2-39" title="39">col &lt;-<span class="st"> </span><span class="kw">match</span>(Xs<span class="op">$</span>isoform_coords,covariates)</a>
<a class="sourceLine" id="cb2-40" title="40">X &lt;-<span class="st"> </span>Matrix<span class="op">::</span><span class="kw">sparseMatrix</span>(<span class="dt">i=</span>row,<span class="dt">j=</span>col,<span class="dt">x=</span>Xs<span class="op">$</span>read_count,<span class="dt">dimnames=</span><span class="kw">list</span>(samples,covariates))</a>
<a class="sourceLine" id="cb2-41" title="41"></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co"># Order by molecular location</span></a>
<a class="sourceLine" id="cb2-43" title="43">split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="dt">x=</span><span class="kw">colnames</span>(X),<span class="dt">split=</span><span class="st">&quot;:|-&quot;</span>)</a>
<a class="sourceLine" id="cb2-44" title="44">chr &lt;-<span class="st"> </span><span class="kw">sapply</span>(split,<span class="cf">function</span>(x) x[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb2-45" title="45">pos &lt;-<span class="st"> </span><span class="kw">sapply</span>(split,<span class="cf">function</span>(x) x[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb2-46" title="46">order &lt;-<span class="st"> </span><span class="kw">order</span>(chr,pos)</a>
<a class="sourceLine" id="cb2-47" title="47">X &lt;-<span class="st"> </span>X[,order]</a>
<a class="sourceLine" id="cb2-48" title="48"></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="cf">if</span>(<span class="ot">FALSE</span>){ <span class="co"># testing</span></a>
<a class="sourceLine" id="cb2-50" title="50">    i &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(Xs)),<span class="dt">size=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-51" title="51">    Xs<span class="op">$</span>read_count[i]</a>
<a class="sourceLine" id="cb2-52" title="52">    X[Xs<span class="op">$</span>barcode[i],Xs<span class="op">$</span>isoform_coords[i]]</a>
<a class="sourceLine" id="cb2-53" title="53">}</a>
<a class="sourceLine" id="cb2-54" title="54"></a>
<a class="sourceLine" id="cb2-55" title="55"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;isoform_all.RData&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">### Downloading &quot;miRNA Expression Quantification&quot;. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">directory &lt;-<span class="st"> </span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">setwd</span>(directory)</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># Downloading data.</span></a>
<a class="sourceLine" id="cb3-10" title="10">project &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">getGDCprojects</span>()<span class="op">$</span>id </a>
<a class="sourceLine" id="cb3-11" title="11">project &lt;-<span class="st"> </span>project[<span class="kw">grepl</span>(<span class="dt">x=</span>project,<span class="dt">pattern=</span><span class="st">&quot;TCGA&quot;</span>)]</a>
<a class="sourceLine" id="cb3-12" title="12">y &lt;-<span class="st"> </span>X &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(project)){</a>
<a class="sourceLine" id="cb3-14" title="14">    query &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCquery</span>(<span class="dt">project=</span>project[i],</a>
<a class="sourceLine" id="cb3-15" title="15">                           <span class="dt">data.category=</span><span class="st">&quot;Transcriptome Profiling&quot;</span>,</a>
<a class="sourceLine" id="cb3-16" title="16">                           <span class="dt">data.type=</span><span class="st">&quot;miRNA Expression Quantification&quot;</span>)</a>
<a class="sourceLine" id="cb3-17" title="17">    TCGAbiolinks<span class="op">::</span><span class="kw">GDCdownload</span>(query,<span class="dt">method=</span><span class="st">&quot;api&quot;</span>,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="kw">trace</span>(TCGAbiolinks<span class="op">:::</span>readTranscriptomeProfiling,<span class="dt">tracer=</span><span class="kw">quote</span>(ignore.case&lt;-<span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb3-19" title="19">    data &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCprepare</span>(query,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb3-20" title="20">    X[[i]] &lt;-<span class="st"> </span><span class="kw">t</span>(data[,<span class="kw">c</span>(<span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">2</span>,<span class="dt">to=</span><span class="kw">ncol</span>(data),<span class="dt">by=</span><span class="dv">3</span>))])</a>
<a class="sourceLine" id="cb3-21" title="21">    y[[i]] &lt;-<span class="st"> </span><span class="kw">rep</span>(project[i],<span class="dt">times=</span><span class="kw">nrow</span>(X[[i]]))</a>
<a class="sourceLine" id="cb3-22" title="22">}</a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;miRNA_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb3-25" title="25"><span class="kw">load</span>(<span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;miRNA_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb3-26" title="26"></a>
<a class="sourceLine" id="cb3-27" title="27">X &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span>rbind,<span class="dt">args=</span>X)</a>
<a class="sourceLine" id="cb3-28" title="28">y &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span><span class="st">&quot;c&quot;</span>,<span class="dt">args=</span>y)</a>
<a class="sourceLine" id="cb3-29" title="29"><span class="kw">rownames</span>(X) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;read_count_&quot;</span>,<span class="dt">replacement=</span><span class="st">&quot;&quot;</span>,<span class="dt">x=</span><span class="kw">rownames</span>(X))</a>
<a class="sourceLine" id="cb3-30" title="30"></a>
<a class="sourceLine" id="cb3-31" title="31"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;miRNA_all.RData&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co">### Downloading &quot;Gene Expression Quantification&quot;. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">directory &lt;-<span class="st"> </span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">setwd</span>(directory)</a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co"># Retrieving cancer types:</span></a>
<a class="sourceLine" id="cb4-10" title="10">project &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">getGDCprojects</span>()<span class="op">$</span>id</a>
<a class="sourceLine" id="cb4-11" title="11">project &lt;-<span class="st"> </span>project[<span class="kw">grepl</span>(<span class="dt">x=</span>project,<span class="dt">pattern=</span><span class="st">&quot;TCGA&quot;</span>)]</a>
<a class="sourceLine" id="cb4-12" title="12"></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co"># Downloading data:</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="kw">memory.limit</span>(<span class="dt">size=</span><span class="dv">16000</span>) <span class="co"># Activate virtual memory in system control!</span></a>
<a class="sourceLine" id="cb4-15" title="15">y &lt;-<span class="st"> </span>X &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb4-16" title="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(project)){</a>
<a class="sourceLine" id="cb4-17" title="17">    query &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCquery</span>(<span class="dt">project=</span>project[i],</a>
<a class="sourceLine" id="cb4-18" title="18">                <span class="dt">data.category=</span><span class="st">&quot;Transcriptome Profiling&quot;</span>,</a>
<a class="sourceLine" id="cb4-19" title="19">                <span class="dt">data.type=</span><span class="st">&quot;Gene Expression Quantification&quot;</span>,</a>
<a class="sourceLine" id="cb4-20" title="20">                <span class="dt">workflow.type=</span><span class="st">&quot;HTSeq - Counts&quot;</span>); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-21" title="21">    TCGAbiolinks<span class="op">::</span><span class="kw">GDCdownload</span>(<span class="dt">query=</span>query,<span class="dt">method=</span><span class="st">&quot;api&quot;</span>,<span class="dt">directory=</span>directory); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-22" title="22">    <span class="kw">trace</span>(TCGAbiolinks<span class="op">:::</span>readTranscriptomeProfiling,<span class="dt">tracer=</span><span class="kw">quote</span>(ignore.case&lt;-<span class="ot">TRUE</span>)); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-23" title="23">    X[[i]] &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCprepare</span>(query,<span class="dt">directory=</span>directory); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-24" title="24">    y[[i]] &lt;-<span class="st"> </span><span class="kw">rep</span>(project[i],<span class="dt">times=</span><span class="kw">ncol</span>(X[[i]])); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb4-25" title="25">}</a>
<a class="sourceLine" id="cb4-26" title="26"></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;gene_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb4-28" title="28"><span class="kw">load</span>(<span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;gene_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb4-29" title="29"></a>
<a class="sourceLine" id="cb4-30" title="30">genes &lt;-<span class="st"> </span>SummarizedExperiment<span class="op">::</span><span class="kw">rowData</span>(X[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb4-31" title="31">mart &lt;-<span class="st"> </span>biomaRt<span class="op">::</span><span class="kw">useMart</span>(<span class="st">&quot;ensembl&quot;</span>,<span class="dt">dataset=</span><span class="st">&quot;hsapiens_gene_ensembl&quot;</span>) <span class="co"># </span></a>
<a class="sourceLine" id="cb4-32" title="32">char &lt;-<span class="st"> </span>biomaRt<span class="op">::</span><span class="kw">getBM</span>(<span class="dt">attributes=</span><span class="kw">c</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>,<span class="st">&quot;chromosome_name&quot;</span>,<span class="st">&quot;transcript_start&quot;</span>,<span class="st">&quot;gene_biotype&quot;</span>),<span class="dt">filters=</span><span class="kw">c</span>(<span class="st">&quot;biotype&quot;</span>,<span class="st">&quot;chromosome_name&quot;</span>),<span class="dt">values=</span><span class="kw">list</span>(<span class="st">&quot;protein_coding&quot;</span>,<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">22</span>,<span class="st">&quot;X&quot;</span>)),<span class="dt">mart=</span>mart)</a>
<a class="sourceLine" id="cb4-33" title="33">select &lt;-<span class="st"> </span>genes<span class="op">$</span>ensembl_gene_id[genes<span class="op">$</span>ensembl_gene_id <span class="op">%in%</span><span class="st"> </span>char<span class="op">$</span>ensembl_gene_id]</a>
<a class="sourceLine" id="cb4-34" title="34"></a>
<a class="sourceLine" id="cb4-35" title="35">X &lt;-<span class="st"> </span><span class="kw">lapply</span>(X,<span class="cf">function</span>(x) <span class="kw">t</span>(SummarizedExperiment<span class="op">::</span><span class="kw">assays</span>(x)<span class="op">$</span><span class="st">&quot;HTSeq - Counts&quot;</span>[select,]))</a>
<a class="sourceLine" id="cb4-36" title="36">X &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span>rbind,<span class="dt">args=</span>X)</a>
<a class="sourceLine" id="cb4-37" title="37">y &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span><span class="st">&quot;c&quot;</span>,<span class="dt">args=</span>y)</a>
<a class="sourceLine" id="cb4-38" title="38"></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;gene_all.RData&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">### Downloading &quot;Copy Number Variation&quot;. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">directory &lt;-<span class="st"> </span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">setwd</span>(directory)</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9">project &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">getGDCprojects</span>()<span class="op">$</span>id</a>
<a class="sourceLine" id="cb5-10" title="10">project &lt;-<span class="st"> </span>project[<span class="kw">grepl</span>(<span class="dt">x=</span>project,<span class="dt">pattern=</span><span class="st">&quot;TCGA&quot;</span>)]</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">y &lt;-<span class="st"> </span>X &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb5-13" title="13"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(project)){</a>
<a class="sourceLine" id="cb5-14" title="14">    query &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCquery</span>(<span class="dt">project=</span>project[i],</a>
<a class="sourceLine" id="cb5-15" title="15">                <span class="dt">data.category=</span><span class="st">&quot;Copy Number Variation&quot;</span>,</a>
<a class="sourceLine" id="cb5-16" title="16">                <span class="dt">data.type=</span><span class="st">&quot;Masked Copy Number Segment&quot;</span>)</a>
<a class="sourceLine" id="cb5-17" title="17">    TCGAbiolinks<span class="op">::</span><span class="kw">GDCdownload</span>(<span class="dt">query=</span>query,<span class="dt">method=</span><span class="st">&quot;api&quot;</span>,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="kw">trace</span>(TCGAbiolinks<span class="op">:::</span>readTranscriptomeProfiling,<span class="dt">tracer=</span><span class="kw">quote</span>(ignore.case&lt;-<span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb5-19" title="19">    X[[i]] &lt;-<span class="st"> </span>TCGAbiolinks<span class="op">::</span><span class="kw">GDCprepare</span>(query,<span class="dt">directory=</span>directory)</a>
<a class="sourceLine" id="cb5-20" title="20">    y[[i]] &lt;-<span class="st"> </span><span class="kw">rep</span>(project[i],<span class="dt">times=</span><span class="kw">length</span>(<span class="kw">unique</span>(X[[i]]<span class="op">$</span>Sample))) <span class="co"># correct?</span></a>
<a class="sourceLine" id="cb5-21" title="21">}</a>
<a class="sourceLine" id="cb5-22" title="22"></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;CNV_raw.RData&quot;</span>))</a>
<a class="sourceLine" id="cb5-24" title="24"><span class="kw">load</span>(<span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;CNV_raw.RData&quot;</span>),<span class="dt">verbose=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co"># Merging CNV data:</span></a>
<a class="sourceLine" id="cb5-27" title="27">Xs &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span>rbind,<span class="dt">args=</span>X) <span class="co"># sparse matrix</span></a>
<a class="sourceLine" id="cb5-28" title="28">y &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span><span class="st">&quot;c&quot;</span>,<span class="dt">args=</span>y)</a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#table(Xs$Sample)</span></a>
<a class="sourceLine" id="cb5-30" title="30"></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co"># Prepare cutting.</span></a>
<a class="sourceLine" id="cb5-32" title="32">cut &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb5-33" title="33">cut<span class="op">$</span>chr &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">22</span>,<span class="st">&quot;X&quot;</span>)</a>
<a class="sourceLine" id="cb5-34" title="34">cut<span class="op">$</span>start &lt;-<span class="st"> </span><span class="kw">sapply</span>(cut<span class="op">$</span>chr,<span class="cf">function</span>(x) <span class="kw">min</span>(Xs<span class="op">$</span>Start[Xs<span class="op">$</span>Chromosome<span class="op">==</span>x]))</a>
<a class="sourceLine" id="cb5-35" title="35">cut<span class="op">$</span>end &lt;-<span class="st"> </span><span class="kw">sapply</span>(cut<span class="op">$</span>chr,<span class="cf">function</span>(x) <span class="kw">max</span>(Xs<span class="op">$</span>End[Xs<span class="op">$</span>Chromosome<span class="op">==</span>x]))</a>
<a class="sourceLine" id="cb5-36" title="36">cut<span class="op">$</span>length &lt;-<span class="st"> </span>cut<span class="op">$</span>end<span class="op">-</span>cut<span class="op">$</span>start</a>
<a class="sourceLine" id="cb5-37" title="37">cut<span class="op">$</span>dist &lt;-<span class="st"> </span><span class="kw">sum</span>(cut<span class="op">$</span>length)<span class="op">/</span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb5-38" title="38">cut<span class="op">$</span>num &lt;-<span class="st"> </span><span class="kw">round</span>(cut<span class="op">$</span>length<span class="op">/</span>cut<span class="op">$</span>dist)</a>
<a class="sourceLine" id="cb5-39" title="39"></a>
<a class="sourceLine" id="cb5-40" title="40"><span class="co"># Create covariates.</span></a>
<a class="sourceLine" id="cb5-41" title="41">cov &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb5-42" title="42">cov<span class="op">$</span>p &lt;-<span class="st"> </span><span class="kw">sum</span>(cut<span class="op">$</span>num)</a>
<a class="sourceLine" id="cb5-43" title="43">cov<span class="op">$</span>chromosome &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">sapply</span>(cut<span class="op">$</span>chr,<span class="cf">function</span>(i) <span class="kw">rep</span>(i,<span class="dt">times=</span>cut<span class="op">$</span>num[i])))</a>
<a class="sourceLine" id="cb5-44" title="44">cov<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">sapply</span>(cut<span class="op">$</span>chr,<span class="cf">function</span>(i) <span class="kw">round</span>(<span class="kw">seq</span>(<span class="dt">from=</span>cut<span class="op">$</span>start[i],<span class="dt">to=</span>cut<span class="op">$</span>end[i],<span class="dt">length.out=</span>cut<span class="op">$</span>num[i]))))</a>
<a class="sourceLine" id="cb5-45" title="45">cov<span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">paste0</span>(cov<span class="op">$</span>chromosome,<span class="st">&quot;:&quot;</span>,cov<span class="op">$</span>location)</a>
<a class="sourceLine" id="cb5-46" title="46"></a>
<a class="sourceLine" id="cb5-47" title="47"><span class="co"># Create indices for each covariate.</span></a>
<a class="sourceLine" id="cb5-48" title="48">index &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">integer</span>()),<span class="dt">times=</span>cov<span class="op">$</span>p)</a>
<a class="sourceLine" id="cb5-49" title="49">pb &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">txtProgressBar</span>(<span class="dt">min=</span><span class="dv">0</span>,<span class="dt">max=</span>cov<span class="op">$</span>p,<span class="dt">style=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb5-50" title="50"><span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_len</span>(cov<span class="op">$</span>p)){</a>
<a class="sourceLine" id="cb5-51" title="51">    utils<span class="op">::</span><span class="kw">setTxtProgressBar</span>(<span class="dt">pb=</span>pb,<span class="dt">value=</span>j)</a>
<a class="sourceLine" id="cb5-52" title="52">    index[[j]] &lt;-<span class="st"> </span><span class="kw">which</span>((Xs<span class="op">$</span>Chromosome<span class="op">==</span>cov<span class="op">$</span>chromosome[j]) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-53" title="53"><span class="st">        </span>(Xs<span class="op">$</span>Start<span class="op">&lt;=</span>cov<span class="op">$</span>location[j]) <span class="op">&amp;</span><span class="st"> </span>(cov<span class="op">$</span>location[j]<span class="op">&lt;=</span>Xs<span class="op">$</span>End)) <span class="co"># consider &lt;</span></a>
<a class="sourceLine" id="cb5-54" title="54">}</a>
<a class="sourceLine" id="cb5-55" title="55"></a>
<a class="sourceLine" id="cb5-56" title="56"><span class="co"># Expand indices to matrix.</span></a>
<a class="sourceLine" id="cb5-57" title="57">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="kw">length</span>(<span class="kw">unique</span>(Xs<span class="op">$</span>Sample)),<span class="dt">ncol=</span>cov<span class="op">$</span>p,</a>
<a class="sourceLine" id="cb5-58" title="58">             <span class="dt">dimnames=</span><span class="kw">list</span>(<span class="kw">unique</span>(Xs<span class="op">$</span>Sample),cov<span class="op">$</span>name))</a>
<a class="sourceLine" id="cb5-59" title="59"><span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(index)){</a>
<a class="sourceLine" id="cb5-60" title="60">    mean &lt;-<span class="st"> </span>Xs<span class="op">$</span>Segment_Mean[index[[j]]]</a>
<a class="sourceLine" id="cb5-61" title="61">    i &lt;-<span class="st"> </span>Xs<span class="op">$</span>Sample[index[[j]]]</a>
<a class="sourceLine" id="cb5-62" title="62">    X[i,j] &lt;-<span class="st"> </span>mean</a>
<a class="sourceLine" id="cb5-63" title="63">}</a>
<a class="sourceLine" id="cb5-64" title="64"></a>
<a class="sourceLine" id="cb5-65" title="65"><span class="cf">if</span>(<span class="ot">FALSE</span>){ <span class="co"># test</span></a>
<a class="sourceLine" id="cb5-66" title="66">    sample &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">rownames</span>(X),<span class="dt">size=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-67" title="67">    covariate &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">colnames</span>(X),<span class="dt">size=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-68" title="68">    split &lt;-<span class="st"> </span><span class="kw">strsplit</span>(covariate,<span class="dt">split=</span><span class="st">&quot;:&quot;</span>)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb5-69" title="69">    a &lt;-<span class="st"> </span>X[sample,covariate]</a>
<a class="sourceLine" id="cb5-70" title="70">    b &lt;-<span class="st"> </span>Xs<span class="op">$</span>Segment_Mean[(Xs<span class="op">$</span>Sample<span class="op">==</span>sample) <span class="op">&amp;</span><span class="st"> </span>(Xs<span class="op">$</span>Chromosome<span class="op">==</span>split[<span class="dv">1</span>]) <span class="op">&amp;</span><span class="st"> </span>(Xs<span class="op">$</span>Start<span class="op">&lt;=</span><span class="kw">as.numeric</span>(split[<span class="dv">2</span>])) <span class="op">&amp;</span><span class="st"> </span>(<span class="kw">as.numeric</span>(split[<span class="dv">2</span>]) <span class="op">&lt;</span><span class="st"> </span>Xs<span class="op">$</span>End)]</a>
<a class="sourceLine" id="cb5-71" title="71">    <span class="kw">all</span>(a<span class="op">==</span>b)</a>
<a class="sourceLine" id="cb5-72" title="72">}</a>
<a class="sourceLine" id="cb5-73" title="73"></a>
<a class="sourceLine" id="cb5-74" title="74"><span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>,<span class="st">&quot;index&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="st">&quot;CNV_all.RData&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">### Extracting samples of interest. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>,<span class="st">&quot;gene&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(type)){</a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="kw">cat</span>(type[i],<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="kw">load</span>(<span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="kw">paste0</span>(type[i],<span class="st">&quot;_all.RData&quot;</span>)),<span class="dt">verbose=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-11" title="11">    </a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="co"># TCGA barcode</span></a>
<a class="sourceLine" id="cb6-13" title="13">    barcode &lt;-<span class="st"> </span><span class="kw">rownames</span>(X)</a>
<a class="sourceLine" id="cb6-14" title="14">    code &lt;-<span class="st"> </span><span class="kw">sapply</span>(barcode,<span class="cf">function</span>(x) <span class="kw">strsplit</span>(x,<span class="dt">split=</span><span class="st">&quot;-&quot;</span>))</a>
<a class="sourceLine" id="cb6-15" title="15">    code &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(<span class="dt">what=</span>rbind,<span class="dt">args=</span>code))</a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="kw">colnames</span>(code) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;project&quot;</span>,<span class="st">&quot;TSS&quot;</span>,<span class="st">&quot;participant&quot;</span>,<span class="st">&quot;sample_vial&quot;</span>,</a>
<a class="sourceLine" id="cb6-17" title="17">                        <span class="st">&quot;portion_analyte&quot;</span>,<span class="st">&quot;plate&quot;</span>,<span class="st">&quot;center&quot;</span>)</a>
<a class="sourceLine" id="cb6-18" title="18">    code<span class="op">$</span>sample &lt;-<span class="st"> </span><span class="kw">substr</span>(code<span class="op">$</span>sample_vial,<span class="dt">start=</span><span class="dv">1</span>,<span class="dt">stop=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-19" title="19">    code<span class="op">$</span>vial &lt;-<span class="st"> </span><span class="kw">substr</span>(code<span class="op">$</span>sample_vial,<span class="dt">start=</span><span class="dv">3</span>,<span class="dt">stop=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-20" title="20">    code<span class="op">$</span>portion &lt;-<span class="st"> </span><span class="kw">substr</span>(code<span class="op">$</span>portion_analyte,<span class="dt">start=</span><span class="dv">1</span>,<span class="dt">stop=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-21" title="21">    code<span class="op">$</span>analyte &lt;-<span class="st"> </span><span class="kw">substr</span>(code<span class="op">$</span>portion_analyte,<span class="dt">start=</span><span class="dv">3</span>,<span class="dt">stop=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-22" title="22">    code<span class="op">$</span>sample_vial &lt;-<span class="st"> </span>code<span class="op">$</span>portion_analyte &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb6-23" title="23">    </a>
<a class="sourceLine" id="cb6-24" title="24">    <span class="co"># solid tumour (except blood for LAML)</span></a>
<a class="sourceLine" id="cb6-25" title="25">    solid &lt;-<span class="st"> </span>(code<span class="op">$</span>sample<span class="op">==</span><span class="st">&quot;01&quot;</span> <span class="op">|</span><span class="st"> </span>(y<span class="op">==</span><span class="st">&quot;TCGA-LAML&quot;</span> <span class="op">&amp;</span><span class="st"> </span>code<span class="op">$</span>sample<span class="op">==</span><span class="st">&quot;03&quot;</span>))</a>
<a class="sourceLine" id="cb6-26" title="26">    X &lt;-<span class="st"> </span>X[solid,]</a>
<a class="sourceLine" id="cb6-27" title="27">    y &lt;-<span class="st"> </span>y[solid]</a>
<a class="sourceLine" id="cb6-28" title="28"></a>
<a class="sourceLine" id="cb6-29" title="29">    <span class="co"># unique samples</span></a>
<a class="sourceLine" id="cb6-30" title="30">    unique &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">duplicated</span>(<span class="kw">substr</span>(<span class="kw">rownames</span>(X),<span class="dt">start=</span><span class="dv">1</span>,<span class="dt">stop=</span><span class="dv">12</span>))</a>
<a class="sourceLine" id="cb6-31" title="31">    X &lt;-<span class="st"> </span>X[unique,]</a>
<a class="sourceLine" id="cb6-32" title="32">    y &lt;-<span class="st"> </span>y[unique]</a>
<a class="sourceLine" id="cb6-33" title="33">    </a>
<a class="sourceLine" id="cb6-34" title="34">    <span class="kw">save</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>,<span class="st">&quot;X&quot;</span>),<span class="dt">file=</span><span class="kw">file.path</span>(path,<span class="st">&quot;data&quot;</span>,<span class="kw">paste0</span>(type[i],<span class="st">&quot;_sub.RData&quot;</span>)))</a>
<a class="sourceLine" id="cb6-35" title="35">}</a>
<a class="sourceLine" id="cb6-36" title="36"></a>
<a class="sourceLine" id="cb6-37" title="37"><span class="co"># isoform: n=9&#39;794, p=194&#39;595, k=32</span></a>
<a class="sourceLine" id="cb6-38" title="38"><span class="co"># miRNA: n=9&#39;794, p=1&#39;881, k=32</span></a>
<a class="sourceLine" id="cb6-39" title="39"><span class="co"># gene: n=9&#39;830, p=19&#39;602, k=33</span></a>
<a class="sourceLine" id="cb6-40" title="40"><span class="co"># CNV: n=10&#39;578, p=10&#39;000, k=33</span></a>
<a class="sourceLine" id="cb6-41" title="41"></a>
<a class="sourceLine" id="cb6-42" title="42"><span class="co">## Understanding barcodes:</span></a>
<a class="sourceLine" id="cb6-43" title="43"><span class="co"># overview: https://wiki.nci.nih.gov/display/TCGA/TCGA+barcode</span></a>
<a class="sourceLine" id="cb6-44" title="44"><span class="co"># details: https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables</span></a>
<a class="sourceLine" id="cb6-45" title="45"></a>
<a class="sourceLine" id="cb6-46" title="46"><span class="co">## Understanding replicate samples:</span></a>
<a class="sourceLine" id="cb6-47" title="47"><span class="co"># http://gdac.broadinstitute.org/runs/sampleReports/latest/READ_Replicate_Samples.html</span></a></code></pre></div>
</div>
<div id="analysis" class="section level1">
<h1>Analysis</h1>
<p>Last data analysis started on 2019-04-12 (R version 3.5.3).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">### Analysing the TCGA data. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="cf">for</span>(type <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;CNV&quot;</span>,<span class="st">&quot;gene&quot;</span>)){ </a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="kw">library</span>(Matrix)</a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">207</span>,<span class="kw">sample</span>(<span class="dv">528</span>))){</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">set.seed</span>(k); <span class="kw">cat</span>(k,<span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="cf">if</span>(type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>k <span class="op">&gt;</span><span class="st"> </span><span class="dv">496</span>){<span class="cf">next</span>}</a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="cf">if</span>(type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CNV&quot;</span>,<span class="st">&quot;gene&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>k <span class="op">&gt;</span><span class="st"> </span><span class="dv">528</span>){<span class="cf">next</span>}</a>
<a class="sourceLine" id="cb7-12" title="12">    </a>
<a class="sourceLine" id="cb7-13" title="13">    <span class="co"># searching for missing cancer-cancer combinations</span></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">setdiff</span>(<span class="kw">ls</span>(),<span class="kw">c</span>(<span class="st">&quot;k&quot;</span>,<span class="st">&quot;type&quot;</span>,<span class="st">&quot;path&quot;</span>,<span class="st">&quot;save&quot;</span>,<span class="st">&quot;file.exists&quot;</span>,<span class="st">&quot;file.remove&quot;</span>))); <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb7-15" title="15">    file0 &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;results/&quot;</span>,type,<span class="st">&quot;_start_&quot;</span>,k,<span class="st">&quot;.RData&quot;</span>)</a>
<a class="sourceLine" id="cb7-16" title="16">    file1 &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;results/&quot;</span>,type,<span class="st">&quot;_loss_&quot;</span>,k,<span class="st">&quot;.RData&quot;</span>)</a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="cf">if</span>(<span class="kw">file.exists</span>(file0)<span class="op">||</span><span class="kw">file.exists</span>(file1)){<span class="cf">next</span>}</a>
<a class="sourceLine" id="cb7-18" title="18">    <span class="kw">save</span>(<span class="dt">object=</span>k,<span class="dt">file=</span>file0)</a>
<a class="sourceLine" id="cb7-19" title="19">    <span class="kw">load</span>(<span class="kw">paste0</span>(<span class="st">&quot;data/&quot;</span>,type,<span class="st">&quot;_sub.RData&quot;</span>))</a>
<a class="sourceLine" id="cb7-20" title="20">    </a>
<a class="sourceLine" id="cb7-21" title="21">    <span class="co"># indicating the cancer-cancer combination</span></a>
<a class="sourceLine" id="cb7-22" title="22">    cancer &lt;-<span class="st"> </span><span class="kw">substring</span>(<span class="dt">text=</span><span class="kw">unique</span>(y),<span class="dt">first=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb7-23" title="23">    comb &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">combn</span>(<span class="dt">x=</span>cancer,<span class="dt">m=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb7-24" title="24">    select &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;TCGA-&quot;</span>,comb[,k])</a>
<a class="sourceLine" id="cb7-25" title="25">    y &lt;-<span class="st"> </span><span class="kw">ifelse</span>(y<span class="op">==</span>select[<span class="dv">1</span>],<span class="dv">1</span>,<span class="kw">ifelse</span>(y<span class="op">==</span>select[<span class="dv">2</span>],<span class="dv">0</span>,<span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb7-26" title="26">    <span class="kw">rm</span>(cancer,select)</a>
<a class="sourceLine" id="cb7-27" title="27">    </a>
<a class="sourceLine" id="cb7-28" title="28">    <span class="co"># removing other cancer types</span></a>
<a class="sourceLine" id="cb7-29" title="29">    cond &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(y)</a>
<a class="sourceLine" id="cb7-30" title="30">    y &lt;-<span class="st"> </span>y[cond]</a>
<a class="sourceLine" id="cb7-31" title="31">    X &lt;-<span class="st"> </span>X[cond,]</a>
<a class="sourceLine" id="cb7-32" title="32">    <span class="kw">rm</span>(cond)</a>
<a class="sourceLine" id="cb7-33" title="33">    </a>
<a class="sourceLine" id="cb7-34" title="34">    <span class="co"># pre-processing</span></a>
<a class="sourceLine" id="cb7-35" title="35">    <span class="cf">if</span>(type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>)){</a>
<a class="sourceLine" id="cb7-36" title="36">      x &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">.prepare</span>(X,<span class="dt">cutoff=</span><span class="st">&quot;zero&quot;</span>)</a>
<a class="sourceLine" id="cb7-37" title="37">    } <span class="cf">else</span> <span class="cf">if</span>(type<span class="op">==</span><span class="st">&quot;gene&quot;</span>){</a>
<a class="sourceLine" id="cb7-38" title="38">      x &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">.prepare</span>(X,<span class="dt">cutoff=</span><span class="st">&quot;knee&quot;</span>)</a>
<a class="sourceLine" id="cb7-39" title="39">    } <span class="cf">else</span> <span class="cf">if</span>(type<span class="op">==</span><span class="st">&quot;CNV&quot;</span>){</a>
<a class="sourceLine" id="cb7-40" title="40">      x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">X=</span>X,<span class="dt">Z=</span><span class="kw">sign</span>(X))</a>
<a class="sourceLine" id="cb7-41" title="41">      x &lt;-<span class="st"> </span><span class="kw">lapply</span>(x,<span class="cf">function</span>(x) <span class="kw">scale</span>(x))</a>
<a class="sourceLine" id="cb7-42" title="42">      <span class="kw">attributes</span>(x)<span class="op">$</span>info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">n=</span><span class="kw">nrow</span>(X),<span class="dt">p=</span><span class="kw">ncol</span>(X),<span class="dt">prop=</span><span class="kw">mean</span>(x<span class="op">$</span>Z<span class="op">==</span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb7-43" title="43">    }</a>
<a class="sourceLine" id="cb7-44" title="44">    <span class="kw">rm</span>(X)</a>
<a class="sourceLine" id="cb7-45" title="45">    </a>
<a class="sourceLine" id="cb7-46" title="46">    <span class="co"># cross-validation</span></a>
<a class="sourceLine" id="cb7-47" title="47">    loss &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(<span class="dt">expr=</span>palasso<span class="op">:::</span><span class="kw">.predict</span>(<span class="dt">y=</span>y,<span class="dt">X=</span>x,<span class="dt">nfolds.int=</span><span class="dv">10</span>),<span class="dt">error=</span><span class="cf">function</span>(e) palasso<span class="op">:::</span><span class="kw">.predict</span>(<span class="dt">y=</span>y,<span class="dt">X=</span>x,<span class="dt">nfolds.int=</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-48" title="48">    </a>
<a class="sourceLine" id="cb7-49" title="49">    <span class="co"># information</span></a>
<a class="sourceLine" id="cb7-50" title="50">    loss<span class="op">$</span>info &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">k=</span>k,</a>
<a class="sourceLine" id="cb7-51" title="51">                       <span class="dt">y0=</span>comb[<span class="dv">2</span>,k],</a>
<a class="sourceLine" id="cb7-52" title="52">                       <span class="dt">y1=</span>comb[<span class="dv">1</span>,k],</a>
<a class="sourceLine" id="cb7-53" title="53">                       <span class="dt">n0=</span><span class="kw">sum</span>(y<span class="op">==</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-54" title="54">                       <span class="dt">n1=</span><span class="kw">sum</span>(y<span class="op">==</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb7-55" title="55">                       <span class="kw">attributes</span>(x)<span class="op">$</span>info,</a>
<a class="sourceLine" id="cb7-56" title="56">                       loss<span class="op">$</span>info)</a>
<a class="sourceLine" id="cb7-57" title="57">    </a>
<a class="sourceLine" id="cb7-58" title="58">    <span class="co"># refit</span></a>
<a class="sourceLine" id="cb7-59" title="59">    object &lt;-<span class="st"> </span>palasso<span class="op">::</span><span class="kw">palasso</span>(<span class="dt">y=</span>y,<span class="dt">X=</span>x,<span class="dt">nfolds=</span><span class="dv">10</span>,<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>,<span class="dt">standard=</span><span class="ot">TRUE</span>,<span class="dt">elastic=</span><span class="ot">TRUE</span>,<span class="dt">shrink=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-60" title="60">    </a>
<a class="sourceLine" id="cb7-61" title="61">    model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">names</span>(object),<span class="st">&quot;elastic&quot;</span>,</a>
<a class="sourceLine" id="cb7-62" title="62">               <span class="kw">paste0</span>(<span class="st">&quot;paired.&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;adaptive&quot;</span>,<span class="st">&quot;standard&quot;</span>,<span class="st">&quot;combined&quot;</span>)))</a>
<a class="sourceLine" id="cb7-63" title="63">    </a>
<a class="sourceLine" id="cb7-64" title="64">    <span class="cf">for</span>(max <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="ot">Inf</span>)){</a>
<a class="sourceLine" id="cb7-65" title="65">      temp &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-66" title="66">      temp<span class="op">$</span>nzero &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">model=</span>model,<span class="dt">x=</span><span class="ot">NA</span>,<span class="dt">z=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb7-67" title="67">      <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(model)){</a>
<a class="sourceLine" id="cb7-68" title="68">        coef &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">coef.palasso</span>(<span class="dt">object=</span>object,<span class="dt">model=</span>model[i],<span class="dt">max=</span>max)</a>
<a class="sourceLine" id="cb7-69" title="69">        temp<span class="op">$</span>nzero<span class="op">$</span>x[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(coef<span class="op">$</span>x<span class="op">!=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-70" title="70">        temp<span class="op">$</span>nzero<span class="op">$</span>z[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(coef<span class="op">$</span>z<span class="op">!=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-71" title="71">      }</a>
<a class="sourceLine" id="cb7-72" title="72">      temp<span class="op">$</span>select &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">subset.palasso</span>(<span class="dt">x=</span>object,<span class="dt">max=</span>max,</a>
<a class="sourceLine" id="cb7-73" title="73">                                              <span class="dt">model=</span><span class="st">&quot;paired.adaptive&quot;</span>)<span class="op">$</span>palasso<span class="op">$</span>select</a>
<a class="sourceLine" id="cb7-74" title="74">      temp<span class="op">$</span>weights &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">weights.palasso</span>(<span class="dt">object=</span>object,<span class="dt">max=</span>max,</a>
<a class="sourceLine" id="cb7-75" title="75">                                                <span class="dt">model=</span><span class="st">&quot;paired.adaptive&quot;</span>)</a>
<a class="sourceLine" id="cb7-76" title="76">      temp<span class="op">$</span>coef &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">coef.palasso</span>(<span class="dt">object=</span>object,<span class="dt">max=</span>max,</a>
<a class="sourceLine" id="cb7-77" title="77">                                          <span class="dt">model=</span><span class="st">&quot;paired.adaptive&quot;</span>)</a>
<a class="sourceLine" id="cb7-78" title="78">      loss[[<span class="kw">paste0</span>(<span class="st">&quot;fit&quot;</span>,max)]] &lt;-<span class="st"> </span>temp</a>
<a class="sourceLine" id="cb7-79" title="79">    }</a>
<a class="sourceLine" id="cb7-80" title="80">    </a>
<a class="sourceLine" id="cb7-81" title="81">    <span class="kw">save</span>(<span class="dt">object=</span>loss,<span class="dt">file=</span>file1)</a>
<a class="sourceLine" id="cb7-82" title="82">    <span class="kw">file.remove</span>(file0)</a>
<a class="sourceLine" id="cb7-83" title="83">  }</a>
<a class="sourceLine" id="cb7-84" title="84">  </a>
<a class="sourceLine" id="cb7-85" title="85">  index &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">grepl</span>(<span class="kw">dir</span>(),<span class="dt">pattern=</span><span class="st">&quot;sessionInfo&quot;</span>))</a>
<a class="sourceLine" id="cb7-86" title="86">  <span class="kw">sink</span>(<span class="kw">paste0</span>(<span class="st">&quot;sessionInfo&quot;</span>,index<span class="op">+</span><span class="dv">1</span>,<span class="st">&quot;.txt&quot;</span>))</a>
<a class="sourceLine" id="cb7-87" title="87">  <span class="kw">date</span>()</a>
<a class="sourceLine" id="cb7-88" title="88">  utils<span class="op">::</span><span class="kw">sessionInfo</span>()</a>
<a class="sourceLine" id="cb7-89" title="89">  devtools<span class="op">::</span><span class="kw">session_info</span>()</a>
<a class="sourceLine" id="cb7-90" title="90">  <span class="kw">sink</span>()</a>
<a class="sourceLine" id="cb7-91" title="91">  </a>
<a class="sourceLine" id="cb7-92" title="92">}</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># The function &lt;&lt;collect&gt;&gt; loads all files from PATH including PATTERN in the file name, loads OBJECT into a list, and executes a function call.</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co"># path: folder</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co"># pattern: character, or NULL (all files)</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co"># object: character vector, or NULL (all objects)</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co"># what: function call</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9">collect &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">path=</span><span class="kw">getwd</span>(),<span class="dt">pattern=</span><span class="st">&quot;&quot;</span>,<span class="dt">object=</span><span class="ot">NULL</span>,<span class="dt">what=</span><span class="st">&quot;rbind&quot;</span>){</a>
<a class="sourceLine" id="cb8-10" title="10">    OBJECT =<span class="st"> </span>object</a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="co"># identify files</span></a>
<a class="sourceLine" id="cb8-12" title="12">    files &lt;-<span class="st"> </span><span class="kw">dir</span>(path)</a>
<a class="sourceLine" id="cb8-13" title="13">    files &lt;-<span class="st"> </span>files[<span class="kw">grepl</span>(<span class="dt">x=</span>files,<span class="dt">pattern=</span>pattern)]</a>
<a class="sourceLine" id="cb8-14" title="14">    files &lt;-<span class="st"> </span>files[<span class="kw">grepl</span>(<span class="dt">x=</span>files,<span class="dt">pattern=</span><span class="st">&quot;.RData&quot;</span>)]</a>
<a class="sourceLine" id="cb8-15" title="15">    number &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="kw">paste0</span>(pattern,<span class="st">&quot;|.RData&quot;</span>),<span class="dt">replacement=</span><span class="st">&quot;&quot;</span>,<span class="dt">x=</span>files)</a>
<a class="sourceLine" id="cb8-16" title="16">    files &lt;-<span class="st"> </span>files[<span class="kw">order</span>(<span class="kw">as.numeric</span>(number))] <span class="co"># trial1</span></a>
<a class="sourceLine" id="cb8-17" title="17">    names &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern=</span><span class="st">&quot;.RData&quot;</span>,<span class="dt">replacement=</span><span class="st">&quot;&quot;</span>,<span class="dt">x=</span>files) <span class="co"># trial1</span></a>
<a class="sourceLine" id="cb8-18" title="18">    <span class="cf">if</span>(<span class="kw">length</span>(files)<span class="op">==</span><span class="dv">0</span>){<span class="kw">stop</span>(<span class="st">&quot;Invalid datasets.&quot;</span>)}</a>
<a class="sourceLine" id="cb8-19" title="19">    <span class="co"># load data</span></a>
<a class="sourceLine" id="cb8-20" title="20">    all &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb8-21" title="21">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(files)){</a>
<a class="sourceLine" id="cb8-22" title="22">        x &lt;-<span class="st"> </span><span class="kw">load</span>(<span class="kw">file.path</span>(path,files[i]))</a>
<a class="sourceLine" id="cb8-23" title="23">        x &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span>x))</a>
<a class="sourceLine" id="cb8-24" title="24">        <span class="cf">if</span>(<span class="kw">is.null</span>(OBJECT)){</a>
<a class="sourceLine" id="cb8-25" title="25">            all[[i]] &lt;-<span class="st"> </span>x</a>
<a class="sourceLine" id="cb8-26" title="26">            <span class="kw">names</span>(all)[i] &lt;-<span class="st"> </span>names[i] </a>
<a class="sourceLine" id="cb8-27" title="27">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb8-28" title="28">            <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(OBJECT)){</a>
<a class="sourceLine" id="cb8-29" title="29">                all[[OBJECT[j]]][[i]] &lt;-<span class="st"> </span>x[[OBJECT[j]]]</a>
<a class="sourceLine" id="cb8-30" title="30">                <span class="kw">names</span>(all[[OBJECT[j]]])[i] &lt;-<span class="st"> </span>names[i]</a>
<a class="sourceLine" id="cb8-31" title="31">            }</a>
<a class="sourceLine" id="cb8-32" title="32">        }</a>
<a class="sourceLine" id="cb8-33" title="33">    }</a>
<a class="sourceLine" id="cb8-34" title="34">    <span class="co"># fuse data</span></a>
<a class="sourceLine" id="cb8-35" title="35">    <span class="cf">if</span>(<span class="kw">is.null</span>(OBJECT)){</a>
<a class="sourceLine" id="cb8-36" title="36">        all &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="dt">what=</span>what,<span class="dt">args=</span>all)</a>
<a class="sourceLine" id="cb8-37" title="37">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb8-38" title="38">        all &lt;-<span class="st"> </span><span class="kw">lapply</span>(all,<span class="cf">function</span>(x) <span class="kw">do.call</span>(<span class="dt">what=</span>what,<span class="dt">args=</span>x))</a>
<a class="sourceLine" id="cb8-39" title="39">    }</a>
<a class="sourceLine" id="cb8-40" title="40">    <span class="kw">return</span>(all)</a>
<a class="sourceLine" id="cb8-41" title="41">}</a>
<a class="sourceLine" id="cb8-42" title="42"></a>
<a class="sourceLine" id="cb8-43" title="43">LOSS &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb8-44" title="44">type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)</a>
<a class="sourceLine" id="cb8-45" title="45"><span class="co">#type &lt;- &quot;miRNA&quot;</span></a>
<a class="sourceLine" id="cb8-46" title="46"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(type)){</a>
<a class="sourceLine" id="cb8-47" title="47">  LOSS[[type[i]]] &lt;-<span class="st"> </span><span class="kw">collect</span>(<span class="dt">path=</span><span class="st">&quot;results&quot;</span>,</a>
<a class="sourceLine" id="cb8-48" title="48">                             <span class="dt">pattern=</span><span class="kw">paste0</span>(type[i],<span class="st">&quot;_loss_&quot;</span>),</a>
<a class="sourceLine" id="cb8-49" title="49">                             <span class="dt">object=</span><span class="kw">c</span>(<span class="st">&quot;deviance&quot;</span>,<span class="st">&quot;auc&quot;</span>,<span class="st">&quot;class&quot;</span>,<span class="st">&quot;info&quot;</span>,</a>
<a class="sourceLine" id="cb8-50" title="50">                                      <span class="kw">paste0</span>(<span class="st">&quot;fit&quot;</span>,<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="ot">Inf</span>))))</a>
<a class="sourceLine" id="cb8-51" title="51">}</a>
<a class="sourceLine" id="cb8-52" title="52"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(LOSS)){</a>
<a class="sourceLine" id="cb8-53" title="53">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>){</a>
<a class="sourceLine" id="cb8-54" title="54">    <span class="kw">colnames</span>(LOSS[[i]][[j]])[<span class="kw">colnames</span>(LOSS[[i]][[j]])<span class="op">==</span><span class="st">&quot;paired.adaptive&quot;</span>] &lt;-<span class="st"> &quot;paired&quot;</span></a>
<a class="sourceLine" id="cb8-55" title="55">  }</a>
<a class="sourceLine" id="cb8-56" title="56">}</a>
<a class="sourceLine" id="cb8-57" title="57"></a>
<a class="sourceLine" id="cb8-58" title="58"><span class="co">#type &lt;- &quot;gene&quot;</span></a>
<a class="sourceLine" id="cb8-59" title="59"><span class="co">#a &lt;- LOSS[[type]]$deviance[rownames(LOSS[[type]]$deviance)==&quot;10&quot;,&quot;paired&quot;]</span></a>
<a class="sourceLine" id="cb8-60" title="60"><span class="co">#b &lt;- LOSS[[type]]$deviance[rownames(LOSS[[type]]$deviance)==&quot;10&quot;,&quot;elastic&quot;]</span></a>
<a class="sourceLine" id="cb8-61" title="61"><span class="co">#mean(a&lt;b)</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">### Testing for significant differences. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&lt;&lt;collect&gt;&gt;</span></a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7">row &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8">col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;10&quot;</span>,<span class="st">&quot;Inf&quot;</span>)</a>
<a class="sourceLine" id="cb9-9" title="9">lay &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;standard_x&quot;</span>,<span class="st">&quot;standard_z&quot;</span>,<span class="st">&quot;standard_xz&quot;</span>,</a>
<a class="sourceLine" id="cb9-10" title="10">         <span class="st">&quot;adaptive_x&quot;</span>,<span class="st">&quot;adaptive_z&quot;</span>,<span class="st">&quot;adaptive_xz&quot;</span>,</a>
<a class="sourceLine" id="cb9-11" title="11">         <span class="st">&quot;elastic&quot;</span>) <span class="co"># added &quot;elastic&quot;</span></a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13">M &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>,<span class="dt">dim=</span><span class="kw">c</span>(<span class="kw">length</span>(row),<span class="kw">length</span>(col),<span class="kw">length</span>(lay)),<span class="dt">dimnames=</span><span class="kw">list</span>(row,col,lay))</a>
<a class="sourceLine" id="cb9-14" title="14"></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(row)){</a>
<a class="sourceLine" id="cb9-16" title="16">  </a>
<a class="sourceLine" id="cb9-17" title="17">  loss &lt;-<span class="st"> </span>LOSS[[row[i]]][<span class="kw">c</span>(<span class="st">&quot;info&quot;</span>,<span class="st">&quot;deviance&quot;</span>)]</a>
<a class="sourceLine" id="cb9-18" title="18">  </a>
<a class="sourceLine" id="cb9-19" title="19">  y0 &lt;-<span class="st"> </span><span class="kw">as.character</span>(loss<span class="op">$</span>info<span class="op">$</span>y0)</a>
<a class="sourceLine" id="cb9-20" title="20">  y1 &lt;-<span class="st"> </span><span class="kw">as.character</span>(loss<span class="op">$</span>info<span class="op">$</span>y1)</a>
<a class="sourceLine" id="cb9-21" title="21">  cancer &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">c</span>(y0,y1)))</a>
<a class="sourceLine" id="cb9-22" title="22">  Z &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">.design</span>(<span class="dt">x=</span>cancer)</a>
<a class="sourceLine" id="cb9-23" title="23">  </a>
<a class="sourceLine" id="cb9-24" title="24">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(col)){</a>
<a class="sourceLine" id="cb9-25" title="25">    </a>
<a class="sourceLine" id="cb9-26" title="26">    <span class="co"># differences</span></a>
<a class="sourceLine" id="cb9-27" title="27">    cond &lt;-<span class="st"> </span><span class="kw">rownames</span>(loss<span class="op">$</span>deviance)<span class="op">==</span>col[j]</a>
<a class="sourceLine" id="cb9-28" title="28">    </a>
<a class="sourceLine" id="cb9-29" title="29">    <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">seq_along</span>(lay)){</a>
<a class="sourceLine" id="cb9-30" title="30">      </a>
<a class="sourceLine" id="cb9-31" title="31">      fill &lt;-<span class="st"> </span>loss<span class="op">$</span>deviance[cond,lay[k]] <span class="op">-</span><span class="st"> </span>loss<span class="op">$</span>deviance[cond,<span class="st">&quot;paired&quot;</span>]</a>
<a class="sourceLine" id="cb9-32" title="32">      X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="kw">length</span>(cancer),<span class="dt">ncol=</span><span class="kw">length</span>(cancer),</a>
<a class="sourceLine" id="cb9-33" title="33">                  <span class="dt">dimnames=</span><span class="kw">list</span>(cancer,cancer))</a>
<a class="sourceLine" id="cb9-34" title="34">      X[<span class="kw">cbind</span>(y0,y1)] &lt;-<span class="st"> </span>X[<span class="kw">cbind</span>(y1,y0)] &lt;-<span class="st"> </span>fill</a>
<a class="sourceLine" id="cb9-35" title="35">      X[<span class="kw">lower.tri</span>(X)] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb9-36" title="36">      </a>
<a class="sourceLine" id="cb9-37" title="37">      <span class="co"># p-values</span></a>
<a class="sourceLine" id="cb9-38" title="38">      pvalue &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dt">times=</span><span class="kw">max</span>(Z))</a>
<a class="sourceLine" id="cb9-39" title="39">      <span class="cf">for</span>(l <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">max</span>(Z))){</a>
<a class="sourceLine" id="cb9-40" title="40">        x &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(X[Z<span class="op">==</span>l])</a>
<a class="sourceLine" id="cb9-41" title="41">        <span class="cf">if</span>(col[j]<span class="op">==</span><span class="st">&quot;10&quot;</span>){</a>
<a class="sourceLine" id="cb9-42" title="42">          alternative &lt;-<span class="st"> &quot;greater&quot;</span> <span class="co"># Never use &quot;two.sided&quot;!</span></a>
<a class="sourceLine" id="cb9-43" title="43">        }</a>
<a class="sourceLine" id="cb9-44" title="44">        <span class="cf">if</span>(col[j]<span class="op">==</span><span class="st">&quot;Inf&quot;</span>){</a>
<a class="sourceLine" id="cb9-45" title="45">          alternative &lt;-<span class="st"> &quot;less&quot;</span> <span class="co"># Never use &quot;two.sided&quot;!</span></a>
<a class="sourceLine" id="cb9-46" title="46">        }</a>
<a class="sourceLine" id="cb9-47" title="47">        pvalue[l] &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">wilcox.test</span>(<span class="dt">x=</span>x,<span class="dt">alternative=</span>alternative,</a>
<a class="sourceLine" id="cb9-48" title="48">                                 <span class="dt">exact=</span><span class="ot">FALSE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb9-49" title="49">      }</a>
<a class="sourceLine" id="cb9-50" title="50">      </a>
<a class="sourceLine" id="cb9-51" title="51">      <span class="co"># Simes</span></a>
<a class="sourceLine" id="cb9-52" title="52">      M[i,j,k] &lt;-<span class="st"> </span>palasso<span class="op">:::</span><span class="kw">.combine</span>(pvalue,<span class="dt">method=</span><span class="st">&quot;simes&quot;</span>)</a>
<a class="sourceLine" id="cb9-53" title="53">    }</a>
<a class="sourceLine" id="cb9-54" title="54">  }</a>
<a class="sourceLine" id="cb9-55" title="55">}</a>
<a class="sourceLine" id="cb9-56" title="56"></a>
<a class="sourceLine" id="cb9-57" title="57"><span class="co"># Table SIG: significance</span></a>
<a class="sourceLine" id="cb9-58" title="58">constraint &lt;-<span class="st"> &quot;10&quot;</span></a>
<a class="sourceLine" id="cb9-59" title="59">table &lt;-<span class="st"> </span><span class="kw">format</span>(M[,constraint,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>],<span class="dt">digits=</span><span class="dv">1</span>,<span class="dt">scientific=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-60" title="60"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">nrow</span>(table))){</a>
<a class="sourceLine" id="cb9-61" title="61">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">ncol</span>(table))){</a>
<a class="sourceLine" id="cb9-62" title="62">        <span class="cf">if</span>(M[i,constraint,j]<span class="op">&gt;=</span><span class="fl">0.05</span>){</a>
<a class="sourceLine" id="cb9-63" title="63">            table[i,j] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;{</span><span class="ch">\\</span><span class="st">color{gray}{&quot;</span>,table[i,j],<span class="st">&quot;}}&quot;</span>)</a>
<a class="sourceLine" id="cb9-64" title="64">        }</a>
<a class="sourceLine" id="cb9-65" title="65">    }</a>
<a class="sourceLine" id="cb9-66" title="66">}</a>
<a class="sourceLine" id="cb9-67" title="67">one &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{standard}&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{adaptive}&quot;</span>,<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb9-68" title="68">two &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>),<span class="st">&quot;}&quot;</span>)</a>
<a class="sourceLine" id="cb9-69" title="69"><span class="kw">rownames</span>(table) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{&quot;</span>,<span class="kw">rownames</span>(table),<span class="st">&quot;}&quot;</span>)</a>
<a class="sourceLine" id="cb9-70" title="70">table &lt;-<span class="st"> </span><span class="kw">rbind</span>(one,two,table,<span class="dt">deparse.level=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb9-71" title="71"><span class="kw">rownames</span>(table)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;~&quot;</span></a>
<a class="sourceLine" id="cb9-72" title="72">xtable &lt;-<span class="st"> </span>xtable<span class="op">::</span><span class="kw">xtable</span>(table,<span class="dt">align=</span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb9-73" title="73">xtable<span class="op">::</span><span class="kw">print.xtable</span>(xtable,<span class="dt">type=</span><span class="st">&quot;latex&quot;</span>,<span class="dt">include.colnames=</span><span class="ot">FALSE</span>,<span class="dt">sanitize.text.function=</span>identity)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">### Comparison with elastic net. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">#&lt;&lt;collect&gt;&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6">row &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)</a>
<a class="sourceLine" id="cb10-7" title="7">col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;10&quot;</span>,<span class="st">&quot;50&quot;</span>,<span class="st">&quot;Inf&quot;</span>)</a>
<a class="sourceLine" id="cb10-8" title="8">better &lt;-<span class="st"> </span>worse &lt;-<span class="st"> </span>less &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="kw">length</span>(row),<span class="dt">ncol=</span><span class="kw">length</span>(col),</a>
<a class="sourceLine" id="cb10-9" title="9">                 <span class="dt">dimnames=</span><span class="kw">list</span>(row,col))</a>
<a class="sourceLine" id="cb10-10" title="10"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(row)){</a>
<a class="sourceLine" id="cb10-11" title="11">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(col)){</a>
<a class="sourceLine" id="cb10-12" title="12">    <span class="co"># proportion of improvements (cross-validation)</span></a>
<a class="sourceLine" id="cb10-13" title="13">    cond &lt;-<span class="st"> </span><span class="kw">rownames</span>(LOSS[[row[i]]]<span class="op">$</span>deviance)<span class="op">==</span>col[j]</a>
<a class="sourceLine" id="cb10-14" title="14">    loss &lt;-<span class="st"> </span>LOSS[[row[i]]]<span class="op">$</span>deviance[cond,<span class="kw">c</span>(<span class="st">&quot;paired&quot;</span>,<span class="st">&quot;elastic&quot;</span>)]</a>
<a class="sourceLine" id="cb10-15" title="15">    better[i,j] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mean</span>(loss[,<span class="st">&quot;paired&quot;</span>]<span class="op">&lt;</span>loss[,<span class="st">&quot;elastic&quot;</span>]),<span class="dt">digits=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-16" title="16">    worse[i,j] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mean</span>(loss[,<span class="st">&quot;paired&quot;</span>]<span class="op">&gt;</span>loss[,<span class="st">&quot;elastic&quot;</span>]),<span class="dt">digits=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-17" title="17">    <span class="co"># average difference in nzero (refitted models)</span></a>
<a class="sourceLine" id="cb10-18" title="18">    df_paired &lt;-<span class="st"> </span><span class="kw">apply</span>(LOSS[[row[i]]][[<span class="kw">paste0</span>(<span class="st">&quot;fit&quot;</span>,col[j])]],<span class="dv">1</span>,<span class="cf">function</span>(x)   <span class="kw">sum</span>(x<span class="op">$</span>nzero[x<span class="op">$</span>nzero[,<span class="st">&quot;model&quot;</span>]<span class="op">==</span><span class="st">&quot;paired.adaptive&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>)]))</a>
<a class="sourceLine" id="cb10-19" title="19">    df_elastic &lt;-<span class="st"> </span><span class="kw">apply</span>(LOSS[[row[i]]][[<span class="kw">paste0</span>(<span class="st">&quot;fit&quot;</span>,col[j])]],<span class="dv">1</span>,<span class="cf">function</span>(x)   <span class="kw">sum</span>(x<span class="op">$</span>nzero[x<span class="op">$</span>nzero[,<span class="st">&quot;model&quot;</span>]<span class="op">==</span><span class="st">&quot;elastic95&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>)]))</a>
<a class="sourceLine" id="cb10-20" title="20">    df_diff &lt;-<span class="st"> </span>df_elastic<span class="op">-</span>df_paired</a>
<a class="sourceLine" id="cb10-21" title="21">    less[i,j] &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mean</span>(df_diff),<span class="dt">digits=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-22" title="22">    <span class="co">#graphics::hist(df_diff,main=paste(row[i],col[j]),xlim=c(-1,1)*max(abs(df_diff)))</span></a>
<a class="sourceLine" id="cb10-23" title="23">  }</a>
<a class="sourceLine" id="cb10-24" title="24">}</a>
<a class="sourceLine" id="cb10-25" title="25">better</a>
<a class="sourceLine" id="cb10-26" title="26">worse</a>
<a class="sourceLine" id="cb10-27" title="27">less</a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">### Analysing the refitted models. </span><span class="al">###</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&lt;&lt;collect&gt;&gt;</span></a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co"># Table SEL: selected model</span></a>
<a class="sourceLine" id="cb11-8" title="8">nzero &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;fit&quot;</span>,<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="ot">Inf</span>))</a>
<a class="sourceLine" id="cb11-9" title="9">model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;standard_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb11-10" title="10">           <span class="kw">paste0</span>(<span class="st">&quot;adaptive_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb11-11" title="11">           <span class="st">&quot;between_xz&quot;</span>,<span class="st">&quot;within_xz&quot;</span>)</a>
<a class="sourceLine" id="cb11-12" title="12">type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)</a>
<a class="sourceLine" id="cb11-13" title="13">table &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>,<span class="dt">dim=</span><span class="kw">c</span>(<span class="kw">length</span>(nzero),<span class="kw">length</span>(model),<span class="kw">length</span>(type)),</a>
<a class="sourceLine" id="cb11-14" title="14">               <span class="dt">dimnames=</span><span class="kw">list</span>(nzero,model,type))</a>
<a class="sourceLine" id="cb11-15" title="15"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(nzero)){</a>
<a class="sourceLine" id="cb11-16" title="16">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(model)){</a>
<a class="sourceLine" id="cb11-17" title="17">        <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">seq_along</span>(type)){</a>
<a class="sourceLine" id="cb11-18" title="18">            sub &lt;-<span class="st"> </span>LOSS[[type[k]]][[nzero[i]]]</a>
<a class="sourceLine" id="cb11-19" title="19">            table[i,j,k] &lt;-<span class="st"> </span><span class="kw">sum</span>(sub[,<span class="st">&quot;select&quot;</span>]<span class="op">==</span>model[j])</a>
<a class="sourceLine" id="cb11-20" title="20">        }</a>
<a class="sourceLine" id="cb11-21" title="21">    }</a>
<a class="sourceLine" id="cb11-22" title="22">}</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="kw">colSums</span>(table[<span class="st">&quot;fit10&quot;</span>,,]) <span class="co"># CHECK WHETHER COMPLETE!</span></a>
<a class="sourceLine" id="cb11-24" title="24">table &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">prop.table</span>(table[<span class="st">&quot;fit10&quot;</span>,,],<span class="dt">margin=</span><span class="dv">2</span>),<span class="dt">digits=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-25" title="25">table &lt;-<span class="st"> </span><span class="kw">t</span>(table)</a>
<a class="sourceLine" id="cb11-26" title="26">table &lt;-<span class="st"> </span>table[,<span class="kw">apply</span>(table,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="kw">any</span>(x<span class="op">!=</span><span class="dv">0</span>))]</a>
<a class="sourceLine" id="cb11-27" title="27"><span class="kw">rownames</span>(table) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{&quot;</span>,<span class="kw">rownames</span>(table),<span class="st">&quot;}&quot;</span>)</a>
<a class="sourceLine" id="cb11-28" title="28">xtable &lt;-<span class="st"> </span>xtable<span class="op">::</span><span class="kw">xtable</span>(table,<span class="dt">align=</span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb11-29" title="29">xtable<span class="op">::</span><span class="kw">print.xtable</span>(xtable,<span class="dt">type=</span><span class="st">&quot;latex&quot;</span>,<span class="dt">include.colnames=</span><span class="ot">FALSE</span>,<span class="dt">sanitize.text.function=</span>identity)</a>
<a class="sourceLine" id="cb11-30" title="30"></a>
<a class="sourceLine" id="cb11-31" title="31"><span class="co"># selected weights and covariates</span></a>
<a class="sourceLine" id="cb11-32" title="32">type &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)</a>
<a class="sourceLine" id="cb11-33" title="33">group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb11-34" title="34">model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;standard_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb11-35" title="35">           <span class="kw">paste0</span>(<span class="st">&quot;adaptive_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb11-36" title="36">           <span class="st">&quot;paired.adaptive&quot;</span>,<span class="st">&quot;elastic&quot;</span>) <span class="co"># added &quot;elastic&quot; , paste0(&quot;elastic&quot;,c(100,75,50,25))</span></a>
<a class="sourceLine" id="cb11-37" title="37">weights10 &lt;-<span class="st"> </span>weightsInf &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="kw">length</span>(group),<span class="dt">ncol=</span><span class="kw">length</span>(type),</a>
<a class="sourceLine" id="cb11-38" title="38">                <span class="dt">dimnames=</span><span class="kw">list</span>(group,type))</a>
<a class="sourceLine" id="cb11-39" title="39">coef10 &lt;-<span class="st"> </span>coefInf &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>,<span class="dt">dim=</span><span class="kw">c</span>(<span class="kw">length</span>(group),<span class="kw">length</span>(type),<span class="kw">length</span>(model)),</a>
<a class="sourceLine" id="cb11-40" title="40">               <span class="dt">dimnames=</span><span class="kw">list</span>(group,type,model))</a>
<a class="sourceLine" id="cb11-41" title="41"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(group)){</a>
<a class="sourceLine" id="cb11-42" title="42">    <span class="cf">for</span>(j <span class="cf">in</span> <span class="kw">seq_along</span>(type)){</a>
<a class="sourceLine" id="cb11-43" title="43">        weights10[,j] &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(<span class="kw">sapply</span>(LOSS[[type[j]]]<span class="op">$</span>fit10[,<span class="st">&quot;weights&quot;</span>],colMeans))</a>
<a class="sourceLine" id="cb11-44" title="44">        weightsInf[,j] &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(<span class="kw">sapply</span>(LOSS[[type[j]]]<span class="op">$</span>fitInf[,<span class="st">&quot;weights&quot;</span>],colMeans))</a>
<a class="sourceLine" id="cb11-45" title="45">        <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">seq_along</span>(model)){</a>
<a class="sourceLine" id="cb11-46" title="46">            coef10[i,j,k] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">sapply</span>(LOSS[[type[j]]]<span class="op">$</span>fit10[,<span class="st">&quot;nzero&quot;</span>], <span class="cf">function</span>(x) <span class="kw">sum</span>(x[x<span class="op">$</span>model<span class="op">==</span>model[k],group[i]])))</a>
<a class="sourceLine" id="cb11-47" title="47">            coefInf[i,j,k] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">sapply</span>(LOSS[[type[j]]]<span class="op">$</span>fitInf[,<span class="st">&quot;nzero&quot;</span>], <span class="cf">function</span>(x) <span class="kw">sum</span>(x[x<span class="op">$</span>model<span class="op">==</span>model[k],group[i]])))</a>
<a class="sourceLine" id="cb11-48" title="48">        }</a>
<a class="sourceLine" id="cb11-49" title="49">    }</a>
<a class="sourceLine" id="cb11-50" title="50">}</a>
<a class="sourceLine" id="cb11-51" title="51"><span class="co"># coef10[&quot;x&quot;,,]+coef10[&quot;z&quot;,,]</span></a>
<a class="sourceLine" id="cb11-52" title="52"></a>
<a class="sourceLine" id="cb11-53" title="53"></a>
<a class="sourceLine" id="cb11-54" title="54"><span class="co"># with sparsity constraint</span></a>
<a class="sourceLine" id="cb11-55" title="55"><span class="kw">round</span>(<span class="kw">prop.table</span>(weights10,<span class="dt">margin=</span><span class="dv">2</span>),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-56" title="56"><span class="kw">round</span>(<span class="kw">prop.table</span>(coef10[,,<span class="st">&quot;paired.adaptive&quot;</span>],<span class="dt">margin=</span><span class="dv">2</span>),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-57" title="57"><span class="kw">round</span>(<span class="kw">colSums</span>(coef10[,,<span class="st">&quot;paired.adaptive&quot;</span>]),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-58" title="58"></a>
<a class="sourceLine" id="cb11-59" title="59"><span class="co"># natural sparsity</span></a>
<a class="sourceLine" id="cb11-60" title="60"><span class="kw">round</span>(<span class="kw">prop.table</span>(weightsInf,<span class="dt">margin=</span><span class="dv">2</span>),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-61" title="61"><span class="kw">round</span>(<span class="kw">prop.table</span>(coefInf[,,<span class="st">&quot;paired.adaptive&quot;</span>],<span class="dt">margin=</span><span class="dv">2</span>),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-62" title="62"><span class="kw">round</span>(<span class="kw">colSums</span>(coefInf[,,<span class="st">&quot;paired.adaptive&quot;</span>]),<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-63" title="63"><span class="kw">round</span>(<span class="kw">colSums</span>(coefInf[,,<span class="st">&quot;elastic&quot;</span>])<span class="op">/</span><span class="kw">colSums</span>(coefInf[,,<span class="st">&quot;paired.adaptive&quot;</span>]),<span class="dv">1</span>) <span class="co"># multiple nzero of elastic net and paired lasso</span></a>
<a class="sourceLine" id="cb11-64" title="64"></a>
<a class="sourceLine" id="cb11-65" title="65"><span class="co"># Table NSC: number of non-zero coefficients</span></a>
<a class="sourceLine" id="cb11-66" title="66">table &lt;-<span class="st"> </span><span class="kw">round</span>(coefInf[<span class="st">&quot;x&quot;</span>,,]<span class="op">+</span>coefInf[<span class="st">&quot;z&quot;</span>,,])</a>
<a class="sourceLine" id="cb11-67" title="67"><span class="kw">colnames</span>(table)[<span class="dv">7</span>] &lt;-<span class="st"> &quot;paired&quot;</span></a>
<a class="sourceLine" id="cb11-68" title="68">one &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{standard}&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{adaptive}&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{paired}&quot;</span>,<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{elastic}&quot;</span>)</a>
<a class="sourceLine" id="cb11-69" title="69">two &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>,<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>,<span class="st">&quot;xz&quot;</span>,<span class="st">&quot;xz&quot;</span>),<span class="st">&quot;}&quot;</span>)</a>
<a class="sourceLine" id="cb11-70" title="70"><span class="kw">rownames</span>(table) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">text{&quot;</span>,<span class="kw">rownames</span>(table),<span class="st">&quot;}&quot;</span>)</a>
<a class="sourceLine" id="cb11-71" title="71">table &lt;-<span class="st"> </span><span class="kw">rbind</span>(one,two,table,<span class="dt">deparse.level=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-72" title="72"><span class="kw">rownames</span>(table)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;~&quot;</span></a>
<a class="sourceLine" id="cb11-73" title="73">xtable &lt;-<span class="st"> </span>xtable<span class="op">::</span><span class="kw">xtable</span>(table,<span class="dt">align=</span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;|&quot;</span>,<span class="st">&quot;c&quot;</span>))</a>
<a class="sourceLine" id="cb11-74" title="74">xtable<span class="op">::</span><span class="kw">print.xtable</span>(xtable,<span class="dt">type=</span><span class="st">&quot;latex&quot;</span>,<span class="dt">include.colnames=</span><span class="ot">FALSE</span>,<span class="dt">sanitize.text.function=</span>identity)</a></code></pre></div>
</div>
<div id="figures" class="section level1">
<h1>Figures</h1>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co">### FIGURE CSW </span><span class="al">###</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-7" title="7">overfit &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co"># simulate</span></a>
<a class="sourceLine" id="cb12-10" title="10">n &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb12-11" title="11">cx &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">rbeta</span>(<span class="dt">n=</span>n,<span class="dt">shape1=</span><span class="fl">0.9</span>,<span class="dt">shape2=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-12" title="12">cz &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">rbeta</span>(<span class="dt">n=</span>n,<span class="dt">shape1=</span><span class="fl">0.4</span>,<span class="dt">shape2=</span><span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb12-13" title="13"></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co"># collection</span></a>
<a class="sourceLine" id="cb12-15" title="15">x &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb12-16" title="16">y &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb12-17" title="17"></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co"># adaptive weights (X only)</span></a>
<a class="sourceLine" id="cb12-19" title="19">x[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb12-20" title="20"><span class="cf">if</span>(overfit){x[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>cx}</a>
<a class="sourceLine" id="cb12-21" title="21">y[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb12-22" title="22"></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co"># adaptive weights (Z only)</span></a>
<a class="sourceLine" id="cb12-24" title="24">x[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb12-25" title="25">y[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb12-26" title="26"><span class="cf">if</span>(overfit){y[[<span class="dv">2</span>]] &lt;-<span class="st"> </span>cz}</a>
<a class="sourceLine" id="cb12-27" title="27"></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co"># adaptive weights (X and Z)</span></a>
<a class="sourceLine" id="cb12-29" title="29">x[[<span class="dv">3</span>]] &lt;-<span class="st"> </span>y[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">0.5</span>,<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb12-30" title="30"><span class="cf">if</span>(overfit){x[[<span class="dv">3</span>]] &lt;-<span class="st"> </span>cx}</a>
<a class="sourceLine" id="cb12-31" title="31"><span class="cf">if</span>(overfit){y[[<span class="dv">3</span>]] &lt;-<span class="st"> </span>cz}</a>
<a class="sourceLine" id="cb12-32" title="32"></a>
<a class="sourceLine" id="cb12-33" title="33"><span class="co"># within-pair weights</span></a>
<a class="sourceLine" id="cb12-34" title="34">x[[<span class="dv">4</span>]] &lt;-<span class="st"> </span>cx<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(cx<span class="op">+</span>cz)</a>
<a class="sourceLine" id="cb12-35" title="35">y[[<span class="dv">4</span>]] &lt;-<span class="st"> </span>cz<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(cx<span class="op">+</span>cz)</a>
<a class="sourceLine" id="cb12-36" title="36"></a>
<a class="sourceLine" id="cb12-37" title="37"><span class="co"># visualisation</span></a>
<a class="sourceLine" id="cb12-38" title="38">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">4.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb12-39" title="39"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="dv">4</span>)){</a>
<a class="sourceLine" id="cb12-40" title="40">    palasso<span class="op">:::</span><span class="kw">plot_pairs</span>(<span class="dt">x=</span>x[[i]],<span class="dt">y=</span>y[[i]],<span class="dt">lwd=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-41" title="41">    <span class="cf">if</span>(i<span class="op">==</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb12-42" title="42">        graphics<span class="op">::</span><span class="kw">mtext</span>(<span class="dt">text=</span><span class="st">&quot;covariate pair&quot;</span>,<span class="dt">side=</span><span class="dv">2</span>,<span class="dt">line=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-43" title="43">    }</a>
<a class="sourceLine" id="cb12-44" title="44">}</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co">### FIGURE DIA </span><span class="al">###</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6">ellipse &lt;-<span class="st"> </span><span class="cf">function</span>(x,y,<span class="dt">a=</span><span class="fl">0.2</span>,<span class="dt">b=</span><span class="fl">0.25</span>,<span class="dt">border=</span><span class="ot">NA</span>){</a>
<a class="sourceLine" id="cb13-7" title="7">    n &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">c</span>(<span class="kw">length</span>(x),<span class="kw">length</span>(y)))</a>
<a class="sourceLine" id="cb13-8" title="8">    <span class="cf">if</span>(<span class="kw">length</span>(x)<span class="op">==</span><span class="dv">1</span>){x &lt;-<span class="st"> </span><span class="kw">rep</span>(x,<span class="dt">times=</span>n)}</a>
<a class="sourceLine" id="cb13-9" title="9">    <span class="cf">if</span>(<span class="kw">length</span>(y)<span class="op">==</span><span class="dv">1</span>){y &lt;-<span class="st"> </span><span class="kw">rep</span>(y,<span class="dt">times=</span>n)}</a>
<a class="sourceLine" id="cb13-10" title="10">    <span class="cf">if</span>(<span class="kw">length</span>(border)<span class="op">==</span><span class="dv">1</span>){border &lt;-<span class="st"> </span><span class="kw">rep</span>(border,<span class="dt">times=</span>n)}</a>
<a class="sourceLine" id="cb13-11" title="11">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(n)){</a>
<a class="sourceLine" id="cb13-12" title="12">        angle &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>,<span class="dt">to=</span><span class="dv">2</span><span class="op">*</span>pi,<span class="dt">length=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb13-13" title="13">        xs &lt;-<span class="st"> </span>x[i] <span class="op">+</span><span class="st"> </span>a <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(angle)</a>
<a class="sourceLine" id="cb13-14" title="14">        ys &lt;-<span class="st"> </span>y[i] <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(angle)</a>
<a class="sourceLine" id="cb13-15" title="15">        graphics<span class="op">::</span><span class="kw">polygon</span>(<span class="dt">x=</span>xs,<span class="dt">y=</span>ys,<span class="dt">col=</span><span class="kw">grey</span>(<span class="fl">0.9</span>),<span class="dt">border=</span>border[i])</a>
<a class="sourceLine" id="cb13-16" title="16">    }</a>
<a class="sourceLine" id="cb13-17" title="17">}</a>
<a class="sourceLine" id="cb13-18" title="18"></a>
<a class="sourceLine" id="cb13-19" title="19">cancer &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ACC&quot;</span>,<span class="st">&quot;BLCA&quot;</span>,<span class="st">&quot;BRCA&quot;</span>,<span class="st">&quot;UVM&quot;</span>)</a>
<a class="sourceLine" id="cb13-20" title="20">number &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">80</span>,<span class="dv">409</span>,<span class="dv">1078</span>,<span class="dv">80</span>)</a>
<a class="sourceLine" id="cb13-21" title="21">col &lt;-<span class="st"> </span>grDevices<span class="op">::</span><span class="kw">rgb</span>(<span class="dt">red=</span><span class="dv">0</span>,<span class="dt">green=</span><span class="dv">0</span>,<span class="dt">blue=</span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">75</span>,<span class="dt">to=</span><span class="dv">255</span>,<span class="dt">length.out=</span><span class="kw">length</span>(number))),<span class="dt">maxColorValue=</span><span class="dv">255</span>)</a>
<a class="sourceLine" id="cb13-22" title="22"></a>
<a class="sourceLine" id="cb13-23" title="23">lwd &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>number)<span class="op">-</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb13-24" title="24">lwd =<span class="st"> </span><span class="kw">pmax</span>(<span class="dv">5</span><span class="op">*</span>number<span class="op">/</span><span class="kw">max</span>(number),<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-25" title="25">x1 &lt;-<span class="st"> </span><span class="fl">1.3</span>; x2 &lt;-<span class="st"> </span><span class="dv">2</span>; x3 &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb13-26" title="26"></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-28" title="28"></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="co"># first layer (bubble)</span></a>
<a class="sourceLine" id="cb13-30" title="30">graphics<span class="op">::</span><span class="kw">plot.new</span>()</a>
<a class="sourceLine" id="cb13-31" title="31">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-32" title="32">graphics<span class="op">::</span><span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="fl">1.1</span>,<span class="fl">3.3</span>),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">1.6</span>,<span class="fl">1.6</span>))</a>
<a class="sourceLine" id="cb13-33" title="33"><span class="kw">ellipse</span>(<span class="dt">x=</span>x1,<span class="dt">y=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb13-34" title="34">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x1,<span class="dt">y=</span><span class="dv">0</span>,<span class="dt">labels=</span><span class="st">&quot;TCGA&quot;</span>,<span class="dt">font=</span><span class="dv">2</span>,<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-35" title="35">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x1,<span class="dt">y=</span><span class="dv">0</span>,<span class="dt">labels=</span><span class="st">&quot;n=9794&quot;</span>,<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">1.2</span>),<span class="dt">cex=</span><span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb13-36" title="36"></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="co"># second layer (colon)</span></a>
<a class="sourceLine" id="cb13-38" title="38">y1 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">1</span>,<span class="dt">to=</span><span class="op">-</span><span class="dv">1</span>,<span class="dt">length.out=</span><span class="kw">length</span>(cancer)<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-39" title="39">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x2,<span class="dt">y=</span>y1[<span class="kw">length</span>(cancer)],<span class="dt">labels=</span><span class="st">&quot;...&quot;</span>,<span class="dt">font=</span><span class="dv">2</span>,<span class="dt">srt=</span><span class="dv">90</span>)</a>
<a class="sourceLine" id="cb13-40" title="40">y1 &lt;-<span class="st"> </span>y1[<span class="op">-</span><span class="kw">length</span>(cancer)]</a>
<a class="sourceLine" id="cb13-41" title="41"></a>
<a class="sourceLine" id="cb13-42" title="42"><span class="co"># first-second layer (connect)</span></a>
<a class="sourceLine" id="cb13-43" title="43">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span>x1<span class="fl">+0.2</span>,<span class="dt">y0=</span><span class="dv">0</span>,<span class="dt">x1=</span>x2<span class="fl">-0.2</span>,<span class="dt">y1=</span>y1,<span class="dt">lwd=</span>lwd,<span class="dt">col=</span>col)</a>
<a class="sourceLine" id="cb13-44" title="44"></a>
<a class="sourceLine" id="cb13-45" title="45"><span class="co"># second layer (bubble)</span></a>
<a class="sourceLine" id="cb13-46" title="46"><span class="kw">ellipse</span>(<span class="dt">x=</span>x2,<span class="dt">y=</span>y1,<span class="dt">a=</span><span class="fl">0.2</span>,<span class="dt">b=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb13-47" title="47">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x2,<span class="dt">y=</span>y1,<span class="dt">labels=</span>cancer,<span class="dt">font=</span><span class="dv">2</span>,<span class="dt">col=</span>col,<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-48" title="48">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x2,<span class="dt">y=</span>y1,<span class="dt">labels=</span><span class="kw">paste0</span>(<span class="st">&quot;n=&quot;</span>,number,<span class="st">&quot;&quot;</span>),<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">1.2</span>),<span class="dt">cex=</span><span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb13-49" title="49"></a>
<a class="sourceLine" id="cb13-50" title="50">comb &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">combn</span>(<span class="dt">x=</span><span class="kw">seq_along</span>(y1),<span class="dt">m=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-51" title="51"></a>
<a class="sourceLine" id="cb13-52" title="52"><span class="co"># third layer (colon)</span></a>
<a class="sourceLine" id="cb13-53" title="53">y2 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="fl">1.5</span>,<span class="dt">to=</span><span class="op">-</span><span class="fl">1.5</span>,<span class="dt">length.out=</span><span class="kw">ncol</span>(comb)<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-54" title="54">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2[<span class="kw">ncol</span>(comb)],<span class="dt">labels=</span><span class="st">&quot;...&quot;</span>,<span class="dt">font=</span><span class="dv">2</span>,<span class="dt">srt=</span><span class="dv">90</span>)</a>
<a class="sourceLine" id="cb13-55" title="55">y2 &lt;-<span class="st"> </span>y2[<span class="op">-</span><span class="kw">ncol</span>(comb)]</a>
<a class="sourceLine" id="cb13-56" title="56"></a>
<a class="sourceLine" id="cb13-57" title="57"><span class="co"># second-third layer (connect)</span></a>
<a class="sourceLine" id="cb13-58" title="58">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span><span class="fl">2.2</span>,<span class="dt">y0=</span>y1[comb[<span class="dv">1</span>,]],<span class="dt">x1=</span><span class="fl">2.7</span>,<span class="dt">y1=</span>y2,<span class="dt">lwd=</span>lwd[comb[<span class="dv">1</span>,]],<span class="dt">col=</span>col[comb[<span class="dv">1</span>,]])</a>
<a class="sourceLine" id="cb13-59" title="59">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span><span class="fl">2.2</span>,<span class="dt">y0=</span>y1[comb[<span class="dv">2</span>,]],<span class="dt">x1=</span><span class="fl">2.7</span>,<span class="dt">y1=</span>y2,<span class="dt">lwd=</span>lwd[comb[<span class="dv">2</span>,]],<span class="dt">col=</span>col[comb[<span class="dv">2</span>,]])</a>
<a class="sourceLine" id="cb13-60" title="60"></a>
<a class="sourceLine" id="cb13-61" title="61"><span class="co"># third layer (bubble)</span></a>
<a class="sourceLine" id="cb13-62" title="62"><span class="kw">ellipse</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2,<span class="dt">a=</span><span class="fl">0.3</span>,<span class="dt">b=</span><span class="fl">0.22</span>)</a>
<a class="sourceLine" id="cb13-63" title="63">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2,<span class="dt">labels=</span><span class="kw">paste0</span>(cancer[comb[<span class="dv">1</span>,]],<span class="st">&quot; &quot;</span>),</a>
<a class="sourceLine" id="cb13-64" title="64">               <span class="dt">font=</span><span class="dv">2</span>,<span class="dt">col=</span>col[comb[<span class="dv">1</span>,]],<span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-65" title="65">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2,<span class="dt">labels=</span><span class="kw">paste0</span>(<span class="st">&quot; &quot;</span>,cancer[comb[<span class="dv">2</span>,]]),</a>
<a class="sourceLine" id="cb13-66" title="66">               <span class="dt">font=</span><span class="dv">2</span>,<span class="dt">col=</span>col[comb[<span class="dv">2</span>,]],<span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-67" title="67">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2,<span class="dt">labels=</span><span class="st">&quot;:&quot;</span>,<span class="dt">font=</span><span class="dv">2</span>,<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-68" title="68">labels &lt;-<span class="st"> </span><span class="kw">apply</span>(comb,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(number[x]))</a>
<a class="sourceLine" id="cb13-69" title="69">labels &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;n=&quot;</span>,labels,<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb13-70" title="70">graphics<span class="op">::</span><span class="kw">text</span>(<span class="dt">x=</span>x3,<span class="dt">y=</span>y2,<span class="dt">labels=</span>labels,<span class="dt">adj=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">1.2</span>),<span class="dt">cex=</span><span class="fl">0.9</span>)</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co">### FIGURE CLA </span><span class="al">###</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>),<span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">2.1</span>,<span class="fl">3.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="cf">for</span>(type <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)){</a>
<a class="sourceLine" id="cb14-9" title="9">    </a>
<a class="sourceLine" id="cb14-10" title="10">    loss &lt;-<span class="st"> </span>LOSS[[type]][<span class="kw">c</span>(<span class="st">&quot;deviance&quot;</span>,<span class="st">&quot;auc&quot;</span>,<span class="st">&quot;class&quot;</span>)]</a>
<a class="sourceLine" id="cb14-11" title="11">    choice &lt;-<span class="st"> &quot;paired&quot;</span></a>
<a class="sourceLine" id="cb14-12" title="12">    loss &lt;-<span class="st"> </span><span class="kw">lapply</span>(loss,<span class="cf">function</span>(x) x[,<span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;standard_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),<span class="kw">paste0</span>(<span class="st">&quot;adaptive_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),choice)])</a>
<a class="sourceLine" id="cb14-13" title="13">    </a>
<a class="sourceLine" id="cb14-14" title="14">    <span class="cf">for</span>(constraint <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;10&quot;</span>)){ <span class="co"># c(&quot;5&quot;,&quot;10&quot;,&quot;Inf&quot;)</span></a>
<a class="sourceLine" id="cb14-15" title="15">        <span class="co"># change</span></a>
<a class="sourceLine" id="cb14-16" title="16">        sub &lt;-<span class="st"> </span><span class="kw">lapply</span>(loss,<span class="cf">function</span>(x) x[<span class="kw">rownames</span>(x)<span class="op">==</span>constraint,])</a>
<a class="sourceLine" id="cb14-17" title="17">        palasso<span class="op">:::</span><span class="kw">plot_score</span>(sub<span class="op">$</span>deviance,<span class="dt">choice=</span>choice)</a>
<a class="sourceLine" id="cb14-18" title="18">        change &lt;-<span class="st"> </span>sub<span class="op">$</span>deviance[,<span class="dv">7</span>]<span class="op">-</span>sub<span class="op">$</span>deviance[,<span class="op">-</span><span class="dv">7</span>]</a>
<a class="sourceLine" id="cb14-19" title="19">        palasso<span class="op">:::</span><span class="kw">plot_box</span>(change,<span class="dt">ylab=</span><span class="st">&quot;change&quot;</span>,<span class="dt">zero=</span><span class="ot">TRUE</span>,<span class="dt">choice=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb14-20" title="20">        <span class="co"># info</span></a>
<a class="sourceLine" id="cb14-21" title="21">        info &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb14-22" title="22">        info<span class="op">$</span>select &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which.min</span>(<span class="kw">apply</span>(sub<span class="op">$</span>deviance,<span class="dv">2</span>,median)[<span class="op">-</span><span class="dv">7</span>]))</a>
<a class="sourceLine" id="cb14-23" title="23">        info<span class="op">$</span>DEV_paired &lt;-<span class="st"> </span><span class="kw">median</span>(sub<span class="op">$</span>deviance[,choice])</a>
<a class="sourceLine" id="cb14-24" title="24">        info<span class="op">$</span>DEV_select &lt;-<span class="st"> </span><span class="kw">median</span>(sub<span class="op">$</span>deviance[,info<span class="op">$</span>select])</a>
<a class="sourceLine" id="cb14-25" title="25">        info<span class="op">$</span>improve &lt;-<span class="st"> </span><span class="kw">mean</span>(sub<span class="op">$</span>deviance[,info<span class="op">$</span>select]<span class="op">&gt;</span>sub<span class="op">$</span>deviance[,choice])</a>
<a class="sourceLine" id="cb14-26" title="26">        info<span class="op">$</span>AUC_paired &lt;-<span class="st"> </span><span class="kw">median</span>(sub<span class="op">$</span>auc[,choice])</a>
<a class="sourceLine" id="cb14-27" title="27">        info<span class="op">$</span>CLASS_paired &lt;-<span class="st"> </span><span class="kw">median</span>(sub<span class="op">$</span>class[,choice])</a>
<a class="sourceLine" id="cb14-28" title="28">        <span class="kw">print</span>(<span class="kw">as.data.frame</span>(info)) <span class="co"># important</span></a>
<a class="sourceLine" id="cb14-29" title="29">    }</a>
<a class="sourceLine" id="cb14-30" title="30">}</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co">### FIGURE DEC </span><span class="al">###</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#graphics::par(oma=c(1.0,1.0,0,0),mar=c(1.5,3.0,0.5,0.5),mfrow=c(1,1))</span></a>
<a class="sourceLine" id="cb15-7" title="7">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">oma=</span><span class="kw">c</span>(<span class="fl">1.0</span>,<span class="fl">1.0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">1.5</span>,<span class="fl">3.0</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>),<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb15-8" title="8"></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="cf">for</span>(type <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;gene&quot;</span>,<span class="st">&quot;isoform&quot;</span>,<span class="st">&quot;miRNA&quot;</span>,<span class="st">&quot;CNV&quot;</span>)){</a>
<a class="sourceLine" id="cb15-10" title="10">    models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;standard_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb15-11" title="11">                <span class="kw">paste0</span>(<span class="st">&quot;adaptive_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),<span class="st">&quot;paired&quot;</span>)</a>
<a class="sourceLine" id="cb15-12" title="12">    constraint &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;10&quot;</span>,<span class="st">&quot;15&quot;</span>,<span class="st">&quot;20&quot;</span>,<span class="st">&quot;25&quot;</span>,<span class="st">&quot;50&quot;</span>,<span class="st">&quot;Inf&quot;</span>)</a>
<a class="sourceLine" id="cb15-13" title="13">    </a>
<a class="sourceLine" id="cb15-14" title="14">    loss &lt;-<span class="st"> </span>LOSS[[type]][<span class="st">&quot;deviance&quot;</span>]</a>
<a class="sourceLine" id="cb15-15" title="15">    </a>
<a class="sourceLine" id="cb15-16" title="16">    loss &lt;-<span class="st"> </span><span class="kw">lapply</span>(loss,<span class="cf">function</span>(x) x[,models])</a>
<a class="sourceLine" id="cb15-17" title="17">    </a>
<a class="sourceLine" id="cb15-18" title="18">    table &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="kw">length</span>(constraint),<span class="dt">ncol=</span><span class="kw">length</span>(models),</a>
<a class="sourceLine" id="cb15-19" title="19">                    <span class="dt">dimnames=</span><span class="kw">list</span>(constraint,models))</a>
<a class="sourceLine" id="cb15-20" title="20">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(constraint)){</a>
<a class="sourceLine" id="cb15-21" title="21">        sub &lt;-<span class="st"> </span><span class="kw">lapply</span>(loss,<span class="cf">function</span>(x) x[<span class="kw">rownames</span>(x)<span class="op">==</span>constraint[i],])</a>
<a class="sourceLine" id="cb15-22" title="22">        table[i,] &lt;-<span class="st"> </span><span class="kw">apply</span>(sub<span class="op">$</span>deviance,<span class="dv">2</span>,median)</a>
<a class="sourceLine" id="cb15-23" title="23">    }</a>
<a class="sourceLine" id="cb15-24" title="24">    </a>
<a class="sourceLine" id="cb15-25" title="25">    <span class="co"># table &lt;- log(table)</span></a>
<a class="sourceLine" id="cb15-26" title="26">    graphics<span class="op">::</span><span class="kw">plot.new</span>()</a>
<a class="sourceLine" id="cb15-27" title="27">    graphics<span class="op">::</span><span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="kw">length</span>(constraint)),<span class="dt">ylim=</span><span class="kw">range</span>(table))</a>
<a class="sourceLine" id="cb15-28" title="28">    graphics<span class="op">::</span><span class="kw">box</span>()</a>
<a class="sourceLine" id="cb15-29" title="29">    constraint[constraint<span class="op">==</span><span class="st">&quot;Inf&quot;</span>] &lt;-<span class="st"> &quot;n&quot;</span></a>
<a class="sourceLine" id="cb15-30" title="30">    graphics<span class="op">::</span><span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb15-31" title="31">    graphics<span class="op">::</span><span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>,<span class="dt">at=</span><span class="kw">seq_along</span>(constraint),<span class="dt">labels=</span>constraint,<span class="dt">tick=</span><span class="ot">FALSE</span>,<span class="dt">line=</span><span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-32" title="32"></a>
<a class="sourceLine" id="cb15-33" title="33">    <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)){</a>
<a class="sourceLine" id="cb15-34" title="34">        <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(models)){</a>
<a class="sourceLine" id="cb15-35" title="35">            lty &lt;-<span class="st"> </span><span class="kw">ifelse</span>(i<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="dv">3</span>,<span class="kw">ifelse</span>(i<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>),<span class="dv">2</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb15-36" title="36">            col &lt;-<span class="st"> </span><span class="kw">ifelse</span>(i<span class="op">==</span><span class="dv">7</span>,<span class="st">&quot;#00007F&quot;</span>,<span class="st">&quot;#FF3535&quot;</span>) </a>
<a class="sourceLine" id="cb15-37" title="37">            pch &lt;-<span class="st"> </span><span class="kw">ifelse</span>(i<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>),<span class="st">&quot;x&quot;</span>,<span class="kw">ifelse</span>(i<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>),<span class="st">&quot;z&quot;</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb15-38" title="38">            <span class="cf">if</span>(k<span class="op">==</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb15-39" title="39">                graphics<span class="op">::</span><span class="kw">lines</span>(table[,i],<span class="dt">col=</span>col,<span class="dt">lty=</span>lty,<span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb15-40" title="40">                graphics<span class="op">::</span><span class="kw">points</span>(table[,i],<span class="dt">col=</span><span class="st">&quot;white&quot;</span>,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span><span class="fl">1.2</span>)</a>
<a class="sourceLine" id="cb15-41" title="41">            } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb15-42" title="42">                graphics<span class="op">::</span><span class="kw">points</span>(table[,i],<span class="dt">col=</span>col,<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">font=</span><span class="dv">2</span>)  </a>
<a class="sourceLine" id="cb15-43" title="43">            }</a>
<a class="sourceLine" id="cb15-44" title="44">        }</a>
<a class="sourceLine" id="cb15-45" title="45">    }</a>
<a class="sourceLine" id="cb15-46" title="46">}</a>
<a class="sourceLine" id="cb15-47" title="47">graphics<span class="op">::</span><span class="kw">title</span>(<span class="dt">ylab=</span><span class="st">&quot;deviance&quot;</span>,<span class="dt">line=</span><span class="fl">0.0</span>,<span class="dt">outer=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-48" title="48">graphics<span class="op">::</span><span class="kw">title</span>(<span class="dt">xlab=</span><span class="st">&quot;sparsity constraint&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;deviance&quot;</span>,<span class="dt">line=</span><span class="fl">0.0</span>,<span class="dt">outer=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co">### FIGURE CNV </span><span class="al">###</span></a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">2.1</span>,<span class="fl">3.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb16-7" title="7">graphics<span class="op">::</span><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>),<span class="dt">nrow=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb16-8" title="8"></a>
<a class="sourceLine" id="cb16-9" title="9">loss &lt;-<span class="st"> </span>LOSS[[type]][<span class="kw">c</span>(<span class="st">&quot;deviance&quot;</span>,<span class="st">&quot;auc&quot;</span>,<span class="st">&quot;class&quot;</span>)]</a>
<a class="sourceLine" id="cb16-10" title="10">loss &lt;-<span class="st"> </span><span class="kw">lapply</span>(loss,<span class="cf">function</span>(x) x[<span class="kw">rownames</span>(x)<span class="op">==</span><span class="st">&quot;10&quot;</span>,])</a>
<a class="sourceLine" id="cb16-11" title="11">model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="st">&quot;standard_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)),</a>
<a class="sourceLine" id="cb16-12" title="12">           <span class="kw">paste0</span>(<span class="st">&quot;adaptive_&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;z&quot;</span>,<span class="st">&quot;xz&quot;</span>)))</a>
<a class="sourceLine" id="cb16-13" title="13"></a>
<a class="sourceLine" id="cb16-14" title="14">diff &lt;-<span class="st"> </span>loss<span class="op">$</span>auc[,<span class="st">&quot;paired&quot;</span>]<span class="op">-</span>loss<span class="op">$</span>auc[,model]</a>
<a class="sourceLine" id="cb16-15" title="15">palasso<span class="op">:::</span><span class="kw">plot_box</span>(diff,<span class="dt">zero=</span><span class="ot">TRUE</span>,<span class="dt">invert=</span><span class="ot">TRUE</span>,<span class="dt">ylab=</span><span class="st">&quot;change&quot;</span>)</a>
<a class="sourceLine" id="cb16-16" title="16">diff &lt;-<span class="st"> </span>loss<span class="op">$</span>class[,<span class="st">&quot;paired&quot;</span>]<span class="op">-</span>loss<span class="op">$</span>class[,model]</a>
<a class="sourceLine" id="cb16-17" title="17">palasso<span class="op">:::</span><span class="kw">plot_box</span>(diff,<span class="dt">zero=</span><span class="ot">TRUE</span>,<span class="dt">ylab=</span><span class="st">&quot;change&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co">### FIGURE MAP </span><span class="al">###</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb17-5" title="5"></a>
<a class="sourceLine" id="cb17-6" title="6">loss &lt;-<span class="st"> </span>LOSS[[<span class="st">&quot;CNV&quot;</span>]][<span class="kw">c</span>(<span class="st">&quot;info&quot;</span>,<span class="st">&quot;auc&quot;</span>)]</a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8">cancer &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">levels</span>(loss<span class="op">$</span>info<span class="op">$</span>y0),<span class="kw">levels</span>(loss<span class="op">$</span>info<span class="op">$</span>y1))))</a>
<a class="sourceLine" id="cb17-9" title="9">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="kw">length</span>(cancer),<span class="dt">ncol=</span><span class="kw">length</span>(cancer),<span class="dt">dimnames=</span><span class="kw">list</span>(cancer,cancer))</a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#Z &lt;- palasso:::.design(x=cancer)</span></a>
<a class="sourceLine" id="cb17-11" title="11">y0 &lt;-<span class="st"> </span><span class="kw">as.character</span>(loss<span class="op">$</span>info<span class="op">$</span>y0)</a>
<a class="sourceLine" id="cb17-12" title="12">y1 &lt;-<span class="st"> </span><span class="kw">as.character</span>(loss<span class="op">$</span>info<span class="op">$</span>y1)</a>
<a class="sourceLine" id="cb17-13" title="13">X[<span class="kw">cbind</span>(y0,y1)] &lt;-<span class="st"> </span>X[<span class="kw">cbind</span>(y1,y0)] &lt;-<span class="st"> </span>loss<span class="op">$</span>auc[<span class="kw">rownames</span>(loss<span class="op">$</span>auc)<span class="op">==</span><span class="st">&quot;10&quot;</span>,<span class="st">&quot;paired&quot;</span>]</a>
<a class="sourceLine" id="cb17-14" title="14"></a>
<a class="sourceLine" id="cb17-15" title="15">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">3.0</span>,<span class="fl">3.0</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">dimnames</span>(X) &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">dimnames</span>(X),<span class="cf">function</span>(x) <span class="kw">paste0</span>(<span class="st">&quot;  &quot;</span>,x,<span class="st">&quot;  &quot;</span>))</a>
<a class="sourceLine" id="cb17-17" title="17">palasso<span class="op">:::</span><span class="kw">plot_table</span>(<span class="dt">X=</span>X,<span class="dt">margin=</span><span class="op">-</span><span class="dv">1</span>,<span class="dt">labels=</span><span class="ot">FALSE</span>,<span class="dt">las=</span><span class="dv">2</span>,<span class="dt">cex=</span><span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">#sort(rowMeans(X,na.rm=TRUE),decreasing=TRUE)[1:2] # keep!</span></a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co">### FIGURE COM </span><span class="al">###</span></a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co"># 32 cancer types for isoform and miRNA</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co"># 33 cancer types for gene and CNV</span></a>
<a class="sourceLine" id="cb18-5" title="5"></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="co">#rm(list=ls())</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="co">#&lt;&lt;functions&gt;&gt;</span></a>
<a class="sourceLine" id="cb18-8" title="8"></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="cf">for</span>(type <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;miRNA&quot;</span>)){</a>
<a class="sourceLine" id="cb18-10" title="10">    </a>
<a class="sourceLine" id="cb18-11" title="11">cancer &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">as.character</span>(<span class="kw">unlist</span>(LOSS[[type]]<span class="op">$</span>info[,<span class="kw">c</span>(<span class="st">&quot;y0&quot;</span>,<span class="st">&quot;y1&quot;</span>)]))))</a>
<a class="sourceLine" id="cb18-12" title="12"></a>
<a class="sourceLine" id="cb18-13" title="13">n &lt;-<span class="st"> </span><span class="kw">length</span>(cancer)</a>
<a class="sourceLine" id="cb18-14" title="14">z &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(palasso<span class="op">:::</span><span class="kw">.design</span>(<span class="dt">x=</span>n))</a>
<a class="sourceLine" id="cb18-15" title="15">x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">seq_len</span>(n),<span class="dt">each=</span>n)</a>
<a class="sourceLine" id="cb18-16" title="16">y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dt">from=</span>n,<span class="dt">to=</span><span class="dv">1</span>,<span class="dt">by=</span><span class="op">-</span><span class="dv">1</span>),<span class="dt">times=</span>n)</a>
<a class="sourceLine" id="cb18-17" title="17">    </a>
<a class="sourceLine" id="cb18-18" title="18">pch &lt;-<span class="st"> </span>z</a>
<a class="sourceLine" id="cb18-19" title="19">pch[pch<span class="op">==</span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb18-20" title="20">pex &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;.&quot;</span>,<span class="st">&quot;O&quot;</span>,<span class="st">&quot;*&quot;</span>,<span class="st">&quot;+&quot;</span>,<span class="st">&quot;o&quot;</span>,<span class="st">&quot;-&quot;</span>,<span class="st">&quot;&#39;&quot;</span>,<span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb18-21" title="21"></a>
<a class="sourceLine" id="cb18-22" title="22"><span class="co"># colour</span></a>
<a class="sourceLine" id="cb18-23" title="23">base &lt;-<span class="st"> </span>grDevices<span class="op">::</span><span class="kw">colorRampPalette</span>(<span class="dt">colors=</span><span class="kw">c</span>(<span class="st">&#39;darkblue&#39;</span>,<span class="st">&#39;blue&#39;</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;darkred&#39;</span>))(n)</a>
<a class="sourceLine" id="cb18-24" title="24">        </a>
<a class="sourceLine" id="cb18-25" title="25">col &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="dt">times=</span><span class="kw">length</span>(z))</a>
<a class="sourceLine" id="cb18-26" title="26">col[z<span class="op">==</span><span class="dv">0</span>] &lt;-<span class="st"> &quot;white&quot;</span></a>
<a class="sourceLine" id="cb18-27" title="27"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(n)){</a>
<a class="sourceLine" id="cb18-28" title="28">    col[z<span class="op">==</span>i] &lt;-<span class="st"> </span>base[i]</a>
<a class="sourceLine" id="cb18-29" title="29">}</a>
<a class="sourceLine" id="cb18-30" title="30"></a>
<a class="sourceLine" id="cb18-31" title="31">graphics<span class="op">::</span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb18-32" title="32">graphics<span class="op">::</span><span class="kw">plot.new</span>()</a>
<a class="sourceLine" id="cb18-33" title="33">graphics<span class="op">::</span><span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,n),<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">1</span>,n))</a>
<a class="sourceLine" id="cb18-34" title="34">graphics<span class="op">::</span><span class="kw">points</span>(<span class="dt">x=</span>x[pch<span class="op">&lt;=</span><span class="dv">25</span>],<span class="dt">y=</span>y[pch<span class="op">&lt;=</span><span class="dv">25</span>],</a>
<a class="sourceLine" id="cb18-35" title="35">                 <span class="dt">pch=</span>pch[pch<span class="op">&lt;=</span><span class="dv">25</span>],<span class="dt">col=</span>col[pch<span class="op">&lt;=</span><span class="dv">25</span>],<span class="dt">cex=</span><span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb18-36" title="36">graphics<span class="op">::</span><span class="kw">points</span>(<span class="dt">x=</span>x[pch<span class="op">&gt;</span><span class="dv">25</span>],<span class="dt">y=</span>y[pch<span class="op">&gt;</span><span class="dv">25</span>],</a>
<a class="sourceLine" id="cb18-37" title="37">                 <span class="dt">pch=</span>pex[(pch<span class="dv">-25</span>)[pch<span class="op">&gt;</span><span class="dv">25</span>]],<span class="dt">col=</span>col[pch<span class="op">&gt;</span><span class="dv">25</span>],<span class="dt">cex=</span><span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb18-38" title="38">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span><span class="dv">0</span>,<span class="dt">x1=</span>n<span class="op">+</span><span class="dv">1</span>,<span class="dt">y0=</span>n<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb18-39" title="39">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span>n<span class="op">+</span><span class="dv">1</span>,<span class="dt">y0=</span>n<span class="op">+</span><span class="dv">1</span>,<span class="dt">y1=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb18-40" title="40">graphics<span class="op">::</span><span class="kw">segments</span>(<span class="dt">x0=</span><span class="dv">0</span>,<span class="dt">x1=</span>n<span class="op">+</span><span class="dv">1</span>,<span class="dt">y0=</span>n<span class="op">+</span><span class="dv">1</span>,<span class="dt">y1=</span><span class="dv">0</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-41" title="41"></a>
<a class="sourceLine" id="cb18-42" title="42">graphics<span class="op">::</span><span class="kw">mtext</span>(<span class="dt">text=</span>cancer,<span class="dt">side=</span><span class="dv">3</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span>n,<span class="dt">las=</span><span class="dv">2</span>,<span class="dt">cex=</span><span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb18-43" title="43">graphics<span class="op">::</span><span class="kw">mtext</span>(<span class="dt">text=</span>cancer,<span class="dt">side=</span><span class="dv">4</span>,<span class="dt">at=</span>n<span class="op">:</span><span class="dv">1</span>,<span class="dt">las=</span><span class="dv">2</span>,<span class="dt">cex=</span><span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb18-44" title="44"></a>
<a class="sourceLine" id="cb18-45" title="45">}</a></code></pre></div>
<hr />
<hr />
<hr />
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
